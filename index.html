<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Atopom, 王亚楠, Android, IOS, Java" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2" />






<meta name="description" content="工作、分享、笔记">
<meta property="og:type" content="website">
<meta property="og:title" content="Atopom博客">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Atopom博客">
<meta property="og:description" content="工作、分享、笔记">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Atopom博客">
<meta name="twitter:description" content="工作、分享、笔记">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"right","display":"post","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title>Atopom博客</title>
  














</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-right 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Atopom博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">分享快乐</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/01/01/designpattern/2016-1-1-DesignPattern-Adapter/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="王亚楠">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Atopom博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/01/01/designpattern/2016-1-1-DesignPattern-Adapter/" itemprop="url">DesignPattern-Adapter</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-01-01T08:27:02+08:00">
                2016-01-01
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/DesignPattern/" itemprop="url" rel="index">
                    <span itemprop="name">DesignPattern</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="适配器模式-Adapter"><a href="#适配器模式-Adapter" class="headerlink" title="适配器模式 Adapter"></a>适配器模式 Adapter</h1><h2 id="适配器模式种类"><a href="#适配器模式种类" class="headerlink" title="适配器模式种类"></a>适配器模式种类</h2><blockquote>
<ol>
<li>对象适配器（组合）</li>
<li>类适配器（多重继承）</li>
</ol>
</blockquote>
<h2 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h2><blockquote>
<p>将一个类的接口，转换成客户期望的另一个接口。<br>适配器让原本接口不兼容的类可以合作无间。</p>
</blockquote>
<h2 id="目的"><a href="#目的" class="headerlink" title="目的"></a>目的</h2><blockquote>
<p>在不改变原有设计的基础上（或者说在无法改变原有设计的时候），为适应新的需求而作出的一种方案。</p>
</blockquote>
<h2 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h2><blockquote>
<p>Android中的ListView、RecyclerView的Adapter，通过相同的Adapter接口方法，使用不同的Adapter算法，展现出不同的布局效果。</p>
</blockquote>
<h2 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h2><ol>
<li>插座和插头</li>
<li>Java中的枚举器<blockquote>
<ol>
<li>旧API<interface>Enumeration，<br>hasMoreElements()、nextElement()；</interface></li>
<li>新API<interface>Iterator，<br>hasNext()、next()、remove()；</interface></li>
<li>设计适配器兼容新旧API（继承Interator，组合Enumeration）<br><interface>EnumerationInterator，<br>hasNext()、next()、remove()；</interface></li>
<li>类图<br><img src="/images/DesignPattern/Adapter_Pattern_Implement_Enumerator.png" alt="设计适配器兼容新旧API类图"></li>
</ol>
</blockquote>
</li>
</ol>
<h2 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h2><blockquote>
<p>可复用，系统需要使用现有的类，而此类的接口不符合系统的需要。那么通过适配器模式就可以让这些功能得到更好的复用。<br>可扩展，在实现适配器功能的时候，可以调用自己开发的功能，从而自然地扩展系统的功能。</p>
</blockquote>
<h2 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h2><blockquote>
<p>过多的使用适配器，会让系统非常零乱，不易整体进行把握。比如，明明看到调用的是A接口，其实内部被适配成了B接口的实现，一个系统如果太多出现这种情况，无异于一场灾难。因此如果不是很有必要，可以不使用适配器，而是直接对系统进行重构。</p>
</blockquote>
<h2 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h2><p>适配器的工作量，和目标接口的大小成正比。</p>
<h2 id="类图"><a href="#类图" class="headerlink" title="类图"></a>类图</h2><p><img src="/images/DesignPattern/Adapter_Pattern_Class_Diagram.png" alt="适配器模式类图"></p>
<h2 id="代码示例"><a href="#代码示例" class="headerlink" title="代码示例"></a>代码示例</h2><h3 id="目标接口"><a href="#目标接口" class="headerlink" title="目标接口"></a>目标接口</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">package com.designpattern.adapter;</div><div class="line"></div><div class="line">/**</div><div class="line"> * 目标接口</div><div class="line"> * @author atopom</div><div class="line"> *</div><div class="line"> */</div><div class="line">public interface Duck &#123;</div><div class="line">	void quack();</div><div class="line">	void fly();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="目标接口实现"><a href="#目标接口实现" class="headerlink" title="目标接口实现"></a>目标接口实现</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">package com.designpattern.adapter;</div><div class="line"></div><div class="line">/**</div><div class="line"> * 目标接口实现类</div><div class="line"> * @author atopom</div><div class="line"> *</div><div class="line"> */</div><div class="line">public class MallardDuck implements Duck &#123;</div><div class="line"></div><div class="line">	@Override</div><div class="line">	public void quack() &#123;</div><div class="line">		System.out.println(&quot;Quack&quot;);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	@Override</div><div class="line">	public void fly() &#123;</div><div class="line">		System.out.println(&quot;I&apos;m flying&quot;);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="被适配者Adaptee"><a href="#被适配者Adaptee" class="headerlink" title="被适配者Adaptee"></a>被适配者Adaptee</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * 被适配者Adaptee：Turkey</div><div class="line"> * @author atopom</div><div class="line"> *</div><div class="line"> */</div><div class="line">public interface Turkey &#123;</div><div class="line">	void gobble();</div><div class="line">	void fly();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="Adaptee实现类"><a href="#Adaptee实现类" class="headerlink" title="Adaptee实现类"></a>Adaptee实现类</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">package com.designpattern.adapter;</div><div class="line"></div><div class="line">/**</div><div class="line"> * 被适配者实现类</div><div class="line"> * @author atopom</div><div class="line"> *</div><div class="line"> */</div><div class="line">public class WildTurkey implements Turkey &#123;</div><div class="line"></div><div class="line">	@Override</div><div class="line">	public void gobble() &#123;</div><div class="line">		System.out.println(&quot;Gobble gobble&quot;);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	@Override</div><div class="line">	public void fly() &#123;</div><div class="line">		System.out.println(&quot;I&apos;m flying a short distance&quot;);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="适配者Adapter"><a href="#适配者Adapter" class="headerlink" title="适配者Adapter"></a>适配者Adapter</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">package com.designpattern.adapter;</div><div class="line"></div><div class="line">/**</div><div class="line"> * 适配器Adapter</div><div class="line"> * @author atopom</div><div class="line"> *</div><div class="line"> */</div><div class="line">public class TurkeyAdapter implements Duck &#123;</div><div class="line"></div><div class="line">	Turkey turkey;</div><div class="line"></div><div class="line">	public TurkeyAdapter(Turkey turkey) &#123;</div><div class="line">		this.turkey = turkey;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	@Override</div><div class="line">	public void quack() &#123;</div><div class="line">		turkey.gobble();</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	@Override</div><div class="line">	public void fly() &#123;</div><div class="line">		for(int i = 0; i &lt; 5; i++) &#123;</div><div class="line">			turkey.fly();</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="测试类"><a href="#测试类" class="headerlink" title="测试类"></a>测试类</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line">package com.designpattern;</div><div class="line"></div><div class="line">import com.designpattern.adapter.*;</div><div class="line"></div><div class="line">/*</div><div class="line"> * 适配器模式</div><div class="line"> *</div><div class="line"> * 将一个类的接口，转换成客户期望的另一个接口。</div><div class="line"> * 适配器让原本接口不兼容的类可以合作无间。</div><div class="line"> *</div><div class="line"> * 适配器的工作量，和目标接口的大小成正比。</div><div class="line"> *</div><div class="line"> * 目的：</div><div class="line"> * 在不改变原有设计的基础上（或者说，在无法改变原有设计的时候），</div><div class="line"> * 为适应新的需求而做出的一个方案。</div><div class="line"> */</div><div class="line"></div><div class="line">/**</div><div class="line"> * 适配器模式测试类</div><div class="line"> * @author atopom</div><div class="line"> *</div><div class="line"> */</div><div class="line">public class AdapterTestDrive &#123;</div><div class="line"></div><div class="line">	public static void main(String[] args) &#123;</div><div class="line">		MallardDuck duck = new MallardDuck();</div><div class="line"></div><div class="line">		WildTurkey turkey = new WildTurkey();</div><div class="line">		Duck turkeyAdapter = new TurkeyAdapter(turkey);</div><div class="line"></div><div class="line">		System.out.println(&quot;The Turkey says...&quot;);</div><div class="line">		turkey.gobble();</div><div class="line">		turkey.fly();</div><div class="line"></div><div class="line">		System.out.println(&quot;\nThe Duck says...&quot;);</div><div class="line">		testDuck(duck);</div><div class="line"></div><div class="line">		System.out.println(&quot;\nThe TurkeyAdapter says...&quot;);</div><div class="line">		testDuck(turkeyAdapter);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	static void testDuck(Duck duck) &#123;</div><div class="line">		duck.quack();</div><div class="line">		duck.fly();</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="结果"><a href="#结果" class="headerlink" title="结果"></a>结果</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">The Turkey says...</div><div class="line">Gobble gobble</div><div class="line">I&apos;m flying a short distance</div><div class="line"></div><div class="line">The Duck says...</div><div class="line">Quack</div><div class="line">I&apos;m flying</div><div class="line"></div><div class="line">The TurkeyAdapter says...</div><div class="line">Gobble gobble</div><div class="line">I&apos;m flying a short distance</div><div class="line">I&apos;m flying a short distance</div><div class="line">I&apos;m flying a short distance</div><div class="line">I&apos;m flying a short distance</div><div class="line">I&apos;m flying a short distance</div></pre></td></tr></table></figure>
<h1 id="代码地址"><a href="#代码地址" class="headerlink" title="代码地址"></a>代码地址</h1><blockquote>
<p><a href="https://github.com/atopom/java_familiar_strange/tree/master/Code/AdapterPattern" target="_blank" rel="external">https://github.com/atopom/java_familiar_strange/tree/master/Code/AdapterPattern</a></p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2015/05/01/android/2015-5-1-Android-Parcelable/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="王亚楠">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Atopom博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2015/05/01/android/2015-5-1-Android-Parcelable/" itemprop="url">Android-Parcelable</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-05-01T19:13:00+08:00">
                2015-05-01
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Parcelable接口"><a href="#Parcelable接口" class="headerlink" title="Parcelable接口"></a>Parcelable接口</h1><p>Parcelable是android.io包下的接口，是Android中推荐使用的序列化接口。</p>
<p>只要实现Parcelable接口的类，就可以使用Parcel进行序列化和反序列化操作。</p>
<h1 id="实现Pacelable接口"><a href="#实现Pacelable接口" class="headerlink" title="实现Pacelable接口"></a>实现Pacelable接口</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div></pre></td><td class="code"><pre><div class="line">public class Book implements Parcelable &#123;</div><div class="line"></div><div class="line">    private String name;</div><div class="line">    private int price;</div><div class="line"></div><div class="line">    public String getName() &#123;</div><div class="line">        return name;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public int getPrice() &#123;</div><div class="line">        return price;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void setName(String name) &#123;</div><div class="line">        this.name = name;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void setPrice(int price) &#123;</div><div class="line">        this.price = price;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public Book() &#123;</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    protected Book(Parcel in) &#123;</div><div class="line">        name = in.readString();</div><div class="line">        price = in.readInt();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    // 固定写法，在Pacel进行反序列化的时候，会通过反射调用CREATOR的方法。    </div><div class="line">    public static final Creator&lt;Book&gt; CREATOR = new Creator&lt;Book&gt;() &#123;</div><div class="line">        @Override</div><div class="line">        public Book createFromParcel(Parcel in) &#123;</div><div class="line">            return new Book(in);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        @Override</div><div class="line">        public Book[] newArray(int size) &#123;</div><div class="line">            return new Book[size];</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public int describeContents() &#123;</div><div class="line">        return 0;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void writeToParcel(Parcel dest, int flags) &#123;</div><div class="line">        dest.writeString(name);</div><div class="line">        dest.writeInt(price);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="Parcel是什么"><a href="#Parcel是什么" class="headerlink" title="Parcel是什么"></a>Parcel是什么</h1><blockquote>
<p>Parcel简单来说是一套机制。可以将序列化之后的数据写入到一个共享内存中，其他进程通过Parcel可以从这块共享内存中读出字节流，并反序列化成对象。<br><img src="http://upload-images.jianshu.io/upload_images/1623602-20ff163f433fa87b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Parcel的工作流程"></p>
</blockquote>
<h2 id="Parcel的读写源码"><a href="#Parcel的读写源码" class="headerlink" title="Parcel的读写源码"></a>Parcel的读写源码</h2><h3 id="Parcel-writeParcelable"><a href="#Parcel-writeParcelable" class="headerlink" title="Parcel.writeParcelable"></a>Parcel.writeParcelable</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">public final void writeParcelable(Parcelable p, int parcelableFlags) &#123;</div><div class="line">    //  先向流中写入p的ClassName</div><div class="line">    writeParcelableCreator(p);</div><div class="line">    // 然后直接调用p的writeToParcel，这个方法也就是我们自己重写的</div><div class="line">    p.writeToParcel(this, parcelableFlags);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>这里需要注意的是，每一个Parcelable对象在写入流之前，都会在前面首先写入这个对象的ClassName，主要是方便后面读的时候，能够知道是哪个类，感觉这个地方还是做的比较粗糙，在Serializable中对应一个序列化类的信息刻画比这简单的一个类名要靠谱得多，所以官方文档上才会说，如果你想进行持久化存储，那么Parcelable不是你的菜，道理很简单，这里不会有任何版本的概念，只要你的类名不改，旧版本的数据就可以被新版本的class进行反序列化，然而class里面的属性可能已经完全不一样了。</p>
</blockquote>
<h3 id="Parcel-readParcelable"><a href="#Parcel-readParcelable" class="headerlink" title="Parcel.readParcelable"></a>Parcel.readParcelable</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">public final &lt;T extends Parcelable&gt; T readParcelable(ClassLoader loader) &#123;</div><div class="line">    // 1. 首先会调用到readParcelableCreator，通过反射读取我们类中定义的CREATOR</div><div class="line">    Parcelable.Creator&lt;?&gt; creator = readParcelableCreator(loader);</div><div class="line">    if (creator == null) &#123;</div><div class="line">        return null;</div><div class="line">    &#125;</div><div class="line">    if (creator instanceof Parcelable.ClassLoaderCreator&lt;?&gt;) &#123;</div><div class="line">      Parcelable.ClassLoaderCreator&lt;?&gt; classLoaderCreator =</div><div class="line">          (Parcelable.ClassLoaderCreator&lt;?&gt;) creator;</div><div class="line">      return (T) classLoaderCreator.createFromParcel(this, loader);</div><div class="line">    &#125;</div><div class="line">    // 2. 然后直接调用CREATOR.createFromParcel(parcel)</div><div class="line">    return (T) creator.createFromParcel(this);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line">// 首先会调用到readParcelableCreator，通过反射读取我们类中定义的CREATOR</div><div class="line">public final Parcelable.Creator&lt;?&gt; readParcelableCreator(ClassLoader loader) &#123;</div><div class="line">    // 首先把类名读取出来</div><div class="line">    String name = readString();</div><div class="line"></div><div class="line">    Parcelable.Creator&lt;?&gt; creator;</div><div class="line">    // mCreators做了一下缓存，如果之前某个classloader把一个parcelable的Creator获取过</div><div class="line">    // 那么就不需要通过反射去查找了</div><div class="line"></div><div class="line">    synchronized (mCreators) &#123;</div><div class="line">        HashMap&lt;String,Parcelable.Creator&lt;?&gt;&gt; map = mCreators.get(loader);</div><div class="line">        if (map == null) &#123;</div><div class="line">            map = new HashMap&lt;&gt;();</div><div class="line">            mCreators.put(loader, map);</div><div class="line">        &#125;</div><div class="line">        creator = map.get(name);</div><div class="line">        if (creator == null) &#123;</div><div class="line">            try &#123;</div><div class="line">                // If loader == null, explicitly emulate Class.forName(String) &quot;caller</div><div class="line">                // classloader&quot; behavior.</div><div class="line">                ClassLoader parcelableClassLoader =</div><div class="line">                        (loader == null ? getClass().getClassLoader() : loader);</div><div class="line">                // 加载我们自己实现Parcelable接口的类</div><div class="line">                Class&lt;?&gt; parcelableClass = Class.forName(name, false,</div><div class="line">                        parcelableClassLoader);</div><div class="line"></div><div class="line">                Field f = parcelableClass.getField(&quot;CREATOR&quot;);</div><div class="line">                Class&lt;?&gt; creatorType = f.getType();</div><div class="line">                creator = (Parcelable.Creator&lt;?&gt;) f.get(null);</div><div class="line">            &#125;</div><div class="line">            catch (Exception e) &#123;</div><div class="line">                    // catch exception</div><div class="line">            &#125;</div><div class="line">            if (creator == null) &#123;</div><div class="line">                throw new BadParcelableException(&quot;Parcelable protocol requires a &quot;</div><div class="line">                        + &quot;non-null Parcelable.Creator object called &quot;</div><div class="line">                        + &quot;CREATOR on class &quot; + name);</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            map.put(name, creator);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    return creator;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="Serializable接口"><a href="#Serializable接口" class="headerlink" title="Serializable接口"></a>Serializable接口</h1><p>Serializable是java.io包下的一个接口，是Java类进行序列化和反序列化的标记接口。</p>
<p>一个类实现了Serializable接口，就可以被ObjectOutputStream和ObjectInputStream进行序列化和反序列化的操作。</p>
<p>被transient描述的属性或类的静态变量是不会被序列化的。</p>
<p>如果一个实现了Serializable接口的类，继承了另外一个类。那么这个类的父类，必须继承Serializable或者提供一个空构造方法。</p>
<blockquote>
<p>反序列化产生的对象并不是通过构造器创造的，所以依赖构造器保证的约束条件在对象反序列化时都无法保证。比如一个设计成单利的类，如果能序列化，那么可以反序列化出N个对象。</p>
</blockquote>
<h1 id="序列化和反序列化中隐藏的方法"><a href="#序列化和反序列化中隐藏的方法" class="headerlink" title="序列化和反序列化中隐藏的方法"></a>序列化和反序列化中隐藏的方法</h1><p>具体的方法修饰符，private protected public 都可以，序列化和反序列化都是通过反射来调用的。</p>
<h2 id="private-Object-writeReplace-throws-ObjectStreamException-ObjectOutPutStream"><a href="#private-Object-writeReplace-throws-ObjectStreamException-ObjectOutPutStream" class="headerlink" title="private Object writeReplace() throws ObjectStreamException ObjectOutPutStream"></a>private Object writeReplace() throws ObjectStreamException ObjectOutPutStream</h2><blockquote>
<p>在序列化一个对象时，会首先调用这个方法，此方法中可以替换原有序列化的对象。</p>
</blockquote>
<h2 id="private-void-writeObject-java-io-ObjectOutputStream-out-throws-IOException"><a href="#private-void-writeObject-java-io-ObjectOutputStream-out-throws-IOException" class="headerlink" title="private void writeObject(java.io.ObjectOutputStream out) throws IOException"></a>private void writeObject(java.io.ObjectOutputStream out) throws IOException</h2><blockquote>
<p>调用ObjectOutputStream.defaultWriteObject()使用的是默认的序列化过程，在调用defaultWriteObject方法后，可以往out流中写入一些数据，在readObject中可以读取。</p>
</blockquote>
<h2 id="private-void-readObject-java-io-ObjectInputStream-in-throws-IOException-ClassNotFoundException"><a href="#private-void-readObject-java-io-ObjectInputStream-in-throws-IOException-ClassNotFoundException" class="headerlink" title="private void readObject(java.io.ObjectInputStream in) throws IOException, ClassNotFoundException"></a>private void readObject(java.io.ObjectInputStream in) throws IOException, ClassNotFoundException</h2><blockquote>
<p>在writeObject中写入的数据，在此方法中需要以写入顺序读取，同时我们注意到这里已经把参数inputstream回调给我们了，我们可以在这个位置注册一个回调，可以在validateObject方法中检查这个反序列化对象是否合法。</p>
</blockquote>
<h2 id="private-Object-readResolve-throws-ObjectStreamException"><a href="#private-Object-readResolve-throws-ObjectStreamException" class="headerlink" title="private Object readResolve() throws ObjectStreamException"></a>private Object readResolve() throws ObjectStreamException</h2><blockquote>
<p>此方法中可以替换反序列化出来的对象。</p>
</blockquote>
<h1 id="实现Serializable接口"><a href="#实现Serializable接口" class="headerlink" title="实现Serializable接口"></a>实现Serializable接口</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * Person类除了writeReplace在序列化时用到,其他的黑科技方法都不会被调用</div><div class="line"> * 原因是我们在writeReplace中将序列化对象替换成了内部代理类,所以以后的序列化过程就是针对SerializableProxy</div><div class="line"> */</div><div class="line">class Person implements Serializable &#123;</div><div class="line"></div><div class="line">	private static final long serialVersionUID = 1L;</div><div class="line">	public String desc;</div><div class="line"></div><div class="line">	public Person(String desc) &#123;</div><div class="line">		this.desc = desc;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	static class SerializableProxy implements Serializable &#123;</div><div class="line"></div><div class="line">		private static final long serialVersionUID = 1L;</div><div class="line">		private String desc;</div><div class="line"></div><div class="line">		private SerializableProxy(Person s) &#123;</div><div class="line">			this.desc = s.desc;</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		/**</div><div class="line">		 * 在这里恢复外围类 注意看这里!!!最大的好处就是我们最后得到的外围类是通过构造器构建的!</div><div class="line">		 *</div><div class="line">		 * @return</div><div class="line">		 */</div><div class="line">		private Object readResolve() &#123;</div><div class="line">			return new Person(desc);</div><div class="line">		&#125;</div><div class="line"></div><div class="line">	&#125;</div><div class="line"></div><div class="line">	/**</div><div class="line">	 * 外围类直接替换成静态内部代理类作为真正的序列化对象</div><div class="line">	 *</div><div class="line">	 * @return</div><div class="line">	 */</div><div class="line">	private Object writeReplace() &#123;</div><div class="line">		return new SerializableProxy(this);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	/**</div><div class="line">	 * 这里主要是为了防止攻击,任何以Persion声明的对象字节流都是流氓!!</div><div class="line">	 * 因为我在writeReplace中已经把序列化的实例指向了SerializableProxy</div><div class="line">	 *</div><div class="line">	 * @param stream</div><div class="line">	 * @throws InvalidObjectException</div><div class="line">	 */</div><div class="line">	private void readObject(ObjectInputStream stream) throws InvalidObjectException &#123;</div><div class="line">		throw new InvalidObjectException(&quot;proxy requied!&quot;);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="自定义Serializable序列化"><a href="#自定义Serializable序列化" class="headerlink" title="自定义Serializable序列化"></a>自定义Serializable序列化</h1><blockquote>
<p>ObjectOutputStream的defaultWriteObject和defaultReadObject，是通过反射的方式实现序列化和反序列化的。<br>这种默认方式，会导致效率上比Android的Parcelable慢。<br>但是如果通过自己实现writeObject和readObject，那么在效率上会比Parcelable快。<a href="https://bitbucket.org/afrishman/androidserializationtest" target="_blank" rel="external">点击链接，查看测试结果</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div></pre></td><td class="code"><pre><div class="line">public class TreeNode implements Serializable, Parcelable &#123;</div><div class="line">    private static final long serialVersionUID = 1L;</div><div class="line"></div><div class="line">    public List&lt;TreeNode&gt; children;</div><div class="line"></div><div class="line">    public String string0;</div><div class="line">    public String string1;</div><div class="line">    public String string2;</div><div class="line"></div><div class="line">    public int int0;</div><div class="line">    public int int1;</div><div class="line">    public int int2;</div><div class="line"></div><div class="line">    public boolean boolean0;</div><div class="line">    public boolean boolean1;</div><div class="line">    public boolean boolean2;</div><div class="line"></div><div class="line">    public TreeNode() &#123;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    protected TreeNode(Parcel in) &#123;</div><div class="line">        if (in.readByte() == 0x01) &#123;</div><div class="line">            children = new ArrayList&lt;TreeNode&gt;();</div><div class="line">            in.readList(children, TreeNode.class.getClassLoader());</div><div class="line">        &#125; else &#123;</div><div class="line">            children = null;</div><div class="line">        &#125;</div><div class="line">        string0 = in.readString();</div><div class="line">        string1 = in.readString();</div><div class="line">        string2 = in.readString();</div><div class="line">        int0 = in.readInt();</div><div class="line">        int1 = in.readInt();</div><div class="line">        int2 = in.readInt();</div><div class="line">        boolean0 = in.readByte() != 0x00;</div><div class="line">        boolean1 = in.readByte() != 0x00;</div><div class="line">        boolean2 = in.readByte() != 0x00;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    private void writeObject(ObjectOutputStream out) throws IOException &#123;</div><div class="line">        out.writeUTF(string0);</div><div class="line">        out.writeUTF(string1);</div><div class="line">        out.writeUTF(string2);</div><div class="line">        out.writeInt(int0);</div><div class="line">        out.writeInt(int1);</div><div class="line">        out.writeInt(int2);</div><div class="line">        out.writeBoolean(boolean0);</div><div class="line">        out.writeBoolean(boolean1);</div><div class="line">        out.writeBoolean(boolean2);</div><div class="line">        if (children != null) &#123;</div><div class="line">            out.writeInt(children.size());</div><div class="line">            for (TreeNode child : children) &#123;</div><div class="line">                child.writeObject(out);</div><div class="line">            &#125;</div><div class="line">        &#125; else &#123;</div><div class="line">            out.writeInt(0);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    private void readObject(ObjectInputStream in) throws IOException, ClassNotFoundException &#123;</div><div class="line">        string0 = in.readUTF();</div><div class="line">        string1 = in.readUTF();</div><div class="line">        string2 = in.readUTF();</div><div class="line">        int0 = in.readInt();</div><div class="line">        int1 = in.readInt();</div><div class="line">        int2 = in.readInt();</div><div class="line">        boolean0 = in.readBoolean();</div><div class="line">        boolean1 = in.readBoolean();</div><div class="line">        boolean2 = in.readBoolean();</div><div class="line">        int childCount = in.readInt();</div><div class="line">        if (childCount &gt; 0) &#123;</div><div class="line">            children = new ArrayList&lt;TreeNode&gt;(childCount);</div><div class="line">            for (int i = 0; i &lt; childCount; i++) &#123;</div><div class="line">                TreeNode child = new TreeNode();</div><div class="line">                child.readObject(in);</div><div class="line">                children.add(child);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public int describeContents() &#123;</div><div class="line">        return 0;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void writeToParcel(Parcel dest, int flags) &#123;</div><div class="line">        if (children == null) &#123;</div><div class="line">            dest.writeByte((byte) (0x00));</div><div class="line">        &#125; else &#123;</div><div class="line">            dest.writeByte((byte) (0x01));</div><div class="line">            dest.writeList(children);</div><div class="line">        &#125;</div><div class="line">        dest.writeString(string0);</div><div class="line">        dest.writeString(string1);</div><div class="line">        dest.writeString(string2);</div><div class="line">        dest.writeInt(int0);</div><div class="line">        dest.writeInt(int1);</div><div class="line">        dest.writeInt(int2);</div><div class="line">        dest.writeByte((byte) (boolean0 ? 0x01 : 0x00));</div><div class="line">        dest.writeByte((byte) (boolean1 ? 0x01 : 0x00));</div><div class="line">        dest.writeByte((byte) (boolean2 ? 0x01 : 0x00));</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public static final Parcelable.Creator&lt;TreeNode&gt; CREATOR = new Parcelable.Creator&lt;TreeNode&gt;() &#123;</div><div class="line">        @Override</div><div class="line">        public TreeNode createFromParcel(Parcel in) &#123;</div><div class="line">            return new TreeNode(in);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        @Override</div><div class="line">        public TreeNode[] newArray(int size) &#123;</div><div class="line">            return new TreeNode[size];</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2015/04/05/android/2015-4-5-Android-IPC-AIDL/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="王亚楠">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Atopom博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2015/04/05/android/2015-4-5-Android-IPC-AIDL/" itemprop="url">Android-IPC-AIDL</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-04-05T14:57:20+08:00">
                2015-04-05
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="一、AIDL是什么"><a href="#一、AIDL是什么" class="headerlink" title="一、AIDL是什么"></a>一、AIDL是什么</h1><blockquote>
<p>AIDL全称是Android Interface Definition Language，也就是Android接口定义语言。</p>
</blockquote>
<h1 id="二、AIDL是干什么的"><a href="#二、AIDL是干什么的" class="headerlink" title="二、AIDL是干什么的"></a>二、AIDL是干什么的</h1><blockquote>
<p>设计这门语言的目的是为了实现进程间通信，尤其是在涉及多进程并发情况下的进程间通信。</p>
</blockquote>
<h2 id="Android中其他进程间通信的方式"><a href="#Android中其他进程间通信的方式" class="headerlink" title="Android中其他进程间通信的方式"></a>Android中其他进程间通信的方式</h2><blockquote>
<p>Bundle、文件共享、、ContentProvider、Socket、BroadcastReceiver，每种方式都有自己的特点，这里不做过多的扩展。</p>
</blockquote>
<h1 id="三、AIDL怎么用"><a href="#三、AIDL怎么用" class="headerlink" title="三、AIDL怎么用"></a>三、AIDL怎么用</h1><h2 id="1、AIDL语法"><a href="#1、AIDL语法" class="headerlink" title="1、AIDL语法"></a>1、AIDL语法</h2><h3 id="文件类型"><a href="#文件类型" class="headerlink" title="文件类型"></a>文件类型</h3><p>用AIDL书写的文件的后缀是 .aidl。</p>
<h3 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h3><ol>
<li>基本数据类型（byte，short，int，long，float，double，boolean，char）</li>
<li>String 和 CharSequence</li>
<li>List：只支持ArrayList，里面每个元素都必须能被AIDL支持</li>
<li>Map：只支持HashMap，里面的Key和Value都必须能被AIDL支持</li>
<li>Parcelable：所有实现Parcelable接口的对象</li>
<li>AIDL：所有的AIDL接口本身也可以在AIDL文件中使用</li>
</ol>
<blockquote>
<p>注意：<br>在编写AIDL文件时，自定义的Parcelable对象必须显示 import ，不管它是否和当前AIDL文件位于同一个包内。<br>比如，现在我们编写了两个文件，一个叫做 Book.java ，另一个叫做 BookManager.aidl，它们都在 com.wangyanan.aidldemo 包下。现在我们需要在 .aidl 文件里使用 Book 对象，那么我们就必须在 .aidl 文件里面写上 import com.wangyanan.aidldemo.Book 。</p>
</blockquote>
<h3 id="定向tag"><a href="#定向tag" class="headerlink" title="定向tag"></a>定向tag</h3><p>AIDL中的定向 tag 表示了在跨进程通信中数据的流向，其中 in 表示数据只能由客户端流向服务端， out 表示数据只能由服务端流向客户端，而 inout 则表示数据可在服务端与客户端之间双向流通。</p>
<p>其中，数据流向是针对在客户端中的那个传入方法的对象而言的。<br>in 为定向 tag 的话表现为服务端将会接收到一个那个对象的完整数据，但是客户端的那个对象不会因为服务端对传参的修改而发生变动；<br>out 的话表现为服务端将会接收到那个对象的的空对象，但是在服务端对接收到的空对象有任何修改之后客户端将会同步变动；<br>inout 为定向 tag 的情况下，服务端将会接收到客户端传来对象的完整信息，并且客户端将会同步服务端对该对象的任何变动。</p>
<h2 id="2、具体操作"><a href="#2、具体操作" class="headerlink" title="2、具体操作"></a>2、具体操作</h2><h3 id="AIDL代码"><a href="#AIDL代码" class="headerlink" title="AIDL代码"></a>AIDL代码</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div></pre></td><td class="code"><pre><div class="line">// Book.java</div><div class="line"></div><div class="line">package com.gn100.ipcserver.aidl;</div><div class="line"></div><div class="line">import android.os.Parcel;</div><div class="line">import android.os.Parcelable;</div><div class="line"></div><div class="line">public class Book implements Parcelable &#123;</div><div class="line"></div><div class="line">    private String name;</div><div class="line">    private int price;</div><div class="line"></div><div class="line">    public String getName() &#123;</div><div class="line">        return name;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public int getPrice() &#123;</div><div class="line">        return price;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void setName(String name) &#123;</div><div class="line">        this.name = name;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void setPrice(int price) &#123;</div><div class="line">        this.price = price;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public Book() &#123;</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    protected Book(Parcel in) &#123;</div><div class="line">        name = in.readString();</div><div class="line">        price = in.readInt();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public static final Creator&lt;Book&gt; CREATOR = new Creator&lt;Book&gt;() &#123;</div><div class="line">        @Override</div><div class="line">        public Book createFromParcel(Parcel in) &#123;</div><div class="line">            return new Book(in);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        @Override</div><div class="line">        public Book[] newArray(int size) &#123;</div><div class="line">            return new Book[size];</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public int describeContents() &#123;</div><div class="line">        return 0;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void writeToParcel(Parcel dest, int flags) &#123;</div><div class="line">        dest.writeString(name);</div><div class="line">        dest.writeInt(price);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void readFromParcel(Parcel dest) &#123;</div><div class="line">        name = dest.readString();</div><div class="line">        price = dest.readInt();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public String toString() &#123;</div><div class="line">        return &quot;name : &quot; + name + &quot; , price : &quot; + price;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">// Book.aidl</div><div class="line"></div><div class="line">//第一类AIDL文件的例子</div><div class="line">//这个文件的作用是引入了一个序列化对象 Book 供其他的AIDL文件使用</div><div class="line">//注意：Book.aidl与Book.java的包名应当是一样的</div><div class="line">package com.gn100.ipcserver.aidl;</div><div class="line"></div><div class="line">//注意parcelable是小写</div><div class="line">parcelable Book;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">// BookManager.aidl</div><div class="line"></div><div class="line">package com.gn100.ipcserver.aidl;</div><div class="line">import com.gn100.ipcserver.aidl.Book;</div><div class="line">import com.gn100.ipcserver.aidl.OnNewBookArrivedListener;</div><div class="line"></div><div class="line">interface BookManager &#123;</div><div class="line">    // 所有的返回值前都不需要加任何东西</div><div class="line">    List&lt;Book&gt; getBooks();</div><div class="line">    Book getBook(String name);</div><div class="line">    int getBookCount();</div><div class="line"></div><div class="line">    // 传参时除了Java基本类型以及String，CharSequence之外的类型</div><div class="line">    // 都需要在前面加上定向tag，具体加什么根据需求而定</div><div class="line">    void addBookIn(in Book book);</div><div class="line">    void addBookOut(out Book book);</div><div class="line">    void addBookInout(inout Book book);</div><div class="line"></div><div class="line">    void registerListener(OnNewBookArrivedListener listener);</div><div class="line">    void unregisterListener(OnNewBookArrivedListener listener);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>注意：这里有一个坑！大家可能注意到了，在 Book.aidl 文件中，我一直在强调：Book.aidl与Book.java的包名应当是一样的。这似乎理所当然的意味着这两个文件应当是在同一个包里面的——事实上，很多比较老的文章里就是这样说的，他们说最好都在 aidl 包里同一个包下，方便移植——然而在 Android Studio 里并不是这样。如果这样做的话，系统根本就找不到 Book.java 文件，从而在其他的AIDL文件里面使用 Book 对象的时候会报 Symbol not found 的错误。为什么会这样呢？因为 Gradle 。Android Studio 是默认使用 Gradle 来构建 Android 项目的，而 Gradle 在构建项目的时候会通过 sourceSets 来配置不同文件的访问路径，从而加快查找速度。Gradle 默认是将 java 代码的访问路径设置在 java 包下的，这样一来，如果 java 文件是放在 aidl 包下的话那么理所当然系统是找不到这个 java 文件的。那应该怎么办呢？</p>
<p>即要 java 文件和 aidl 文件的包名是一样的，又要能找到这个 java 文件——那么仔细想一下的话，其实解决方法是很显而易见的。首先我们可以把问题转化成：如何在保证两个文件包名一样的情况下，让系统能够找到我们的 java 文件？这样一来思路就很明确了：要么让系统来 aidl 包里面来找 java 文件，要么把 java 文件放到系统能找到的地方去，也即放到 java 包里面去。</p>
<blockquote>
<p>方法一<br>修改 build.gradle 文件：在 android{} 中间加上下面的内容。<br>也就是把 java 代码的访问路径设置成了 java 包和 aidl 包，这样一来系统就会到 aidl 包里面去查找 java 文件，也就达到了我们的目的。只是有一点，这样设置后 Android Studio 中的项目目录会有一些改变，我感觉改得挺难看的。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">sourceSets &#123;</div><div class="line">    main &#123;</div><div class="line">        java.srcDirs = [&apos;src/main/java&apos;, &apos;src/main/aidl&apos;]</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>方法二<br>把 java 文件放到 java 包下去：把 Book.java 放到 java 包里任意一个包下，保持其包名不变，与 Book.aidl 一致。只要它的包名不变，Book.aidl 就能找到 Book.java ，而只要 Book.java 在 java 包下，那么系统也是能找到它的。但是这样做的话也有一个问题，就是在移植相关 .aidl 文件和 .java 文件的时候没那么方便，不能直接把整个 aidl 文件夹拿过去完事儿了，还要单独将 .java 文件放到 java 文件夹里去。</p>
</blockquote>
<h3 id="服务端代码"><a href="#服务端代码" class="headerlink" title="服务端代码"></a>服务端代码</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div></pre></td><td class="code"><pre><div class="line">// AIDLService.java</div><div class="line"></div><div class="line">package com.gn100.ipcserver.service;</div><div class="line"></div><div class="line">import android.app.Service;</div><div class="line">import android.content.Intent;</div><div class="line">import android.os.IBinder;</div><div class="line">import android.os.RemoteCallbackList;</div><div class="line">import android.os.RemoteException;</div><div class="line">import android.support.annotation.Nullable;</div><div class="line">import android.text.TextUtils;</div><div class="line">import android.util.Log;</div><div class="line"></div><div class="line">import com.gn100.ipcserver.aidl.Book;</div><div class="line">import com.gn100.ipcserver.aidl.BookManager;</div><div class="line">import com.gn100.ipcserver.aidl.OnNewBookArrivedListener;</div><div class="line"></div><div class="line">import java.util.ArrayList;</div><div class="line">import java.util.List;</div><div class="line">import java.util.concurrent.CopyOnWriteArrayList;</div><div class="line">import java.util.concurrent.atomic.AtomicBoolean;</div><div class="line"></div><div class="line">public class AIDLService extends Service &#123;</div><div class="line"></div><div class="line">    private static final String TAG = AIDLService.class.getCanonicalName();</div><div class="line"></div><div class="line">    private AtomicBoolean mIsServiceDestoryed = new AtomicBoolean(false);</div><div class="line">    private List&lt;Book&gt; mBooks = new CopyOnWriteArrayList&lt;&gt;();</div><div class="line">    private RemoteCallbackList&lt;OnNewBookArrivedListener&gt; mNewBookArrivedListeners = new RemoteCallbackList&lt;OnNewBookArrivedListener&gt;();</div><div class="line"></div><div class="line">    private BookManager.Stub mBookManager = new BookManager.Stub() &#123;</div><div class="line">        @Override</div><div class="line">        public List&lt;Book&gt; getBooks() throws RemoteException &#123;</div><div class="line">            synchronized (this) &#123;</div><div class="line">                Log.e(TAG, &quot;invoking getBooks() method , now the list is : &quot; + mBooks.toString());</div><div class="line">                return mBooks != null ? mBooks : new ArrayList&lt;Book&gt;();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        @Override</div><div class="line">        public Book getBook(String name) throws RemoteException &#123;</div><div class="line">            synchronized (this) &#123;</div><div class="line">                Book book = null;</div><div class="line">                if (mBooks != null &amp;&amp; !TextUtils.isEmpty(name)) &#123;</div><div class="line">                    for (Book b : mBooks) &#123;</div><div class="line">                        if (name.equals(b.getName())) &#123;</div><div class="line">                            book = b;</div><div class="line">                        &#125;</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">                Log.e(TAG, &quot;invoking getBook() method , now the book is : &quot; + book.toString());</div><div class="line">                return book;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        @Override</div><div class="line">        public int getBookCount() throws RemoteException &#123;</div><div class="line">            synchronized (this) &#123;</div><div class="line">                Log.e(TAG, &quot;invoking getBookCount() method , now the bookCount is : &quot; + mBooks.size());</div><div class="line">                return mBooks == null ? 0 : mBooks.size();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        @Override</div><div class="line">        public void addBookIn(Book book) throws RemoteException &#123;</div><div class="line">            synchronized (this) &#123;</div><div class="line">                if (mBooks == null) &#123;</div><div class="line">                    mBooks = new ArrayList&lt;&gt;();</div><div class="line">                &#125;</div><div class="line">                if (book == null) &#123;</div><div class="line">                    Log.e(TAG, &quot;Book is null in In&quot;);</div><div class="line">                    book = new Book();</div><div class="line">                &#125;</div><div class="line">                //尝试修改book的参数，主要是为了观察其到客户端的反馈</div><div class="line">                book.setPrice(11111);</div><div class="line">                if (!mBooks.contains(book)) &#123;</div><div class="line">                    mBooks.add(book);</div><div class="line">                &#125;</div><div class="line">                //打印mBooks列表，观察客户端传过来的值</div><div class="line">                Log.e(TAG, &quot;invoking addBookIn() method , now the list is : &quot; + mBooks.toString());</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        @Override</div><div class="line">        public void addBookOut(Book book) throws RemoteException &#123;</div><div class="line">            synchronized (this) &#123;</div><div class="line">                if (mBooks == null) &#123;</div><div class="line">                    mBooks = new ArrayList&lt;&gt;();</div><div class="line">                &#125;</div><div class="line">                if (book == null) &#123;</div><div class="line">                    Log.e(TAG, &quot;Book is null in Out&quot;);</div><div class="line">                    book = new Book();</div><div class="line">                &#125;</div><div class="line">                //尝试修改book的参数，主要是为了观察其到客户端的反馈</div><div class="line">                book.setPrice(22222);</div><div class="line">                if (!mBooks.contains(book)) &#123;</div><div class="line">                    mBooks.add(book);</div><div class="line">                &#125;</div><div class="line">                //打印mBooks列表，观察客户端传过来的值</div><div class="line">                Log.e(TAG, &quot;invoking addBookOut() method , now the list is : &quot; + mBooks.toString());</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        @Override</div><div class="line">        public void addBookInout(Book book) throws RemoteException &#123;</div><div class="line">            synchronized (this) &#123;</div><div class="line">                if (mBooks == null) &#123;</div><div class="line">                    mBooks = new ArrayList&lt;&gt;();</div><div class="line">                &#125;</div><div class="line">                if (book == null) &#123;</div><div class="line">                    Log.e(TAG, &quot;Book is null in Inout&quot;);</div><div class="line">                    book = new Book();</div><div class="line">                &#125;</div><div class="line">                //尝试修改book的参数，主要是为了观察其到客户端的反馈</div><div class="line">                book.setPrice(33333);</div><div class="line">                if (!mBooks.contains(book)) &#123;</div><div class="line">                    mBooks.add(book);</div><div class="line">                &#125;</div><div class="line">                //打印mBooks列表，观察客户端传过来的值</div><div class="line">                Log.e(TAG, &quot;invoking addBookInout() method , now the list is : &quot; + mBooks.toString());</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        @Override</div><div class="line">        public void registerListener(OnNewBookArrivedListener listener) throws RemoteException &#123;</div><div class="line">            boolean success = mNewBookArrivedListeners.register(listener);</div><div class="line">            if(success) &#123;</div><div class="line">                Log.d(TAG, &quot;register success&quot;);</div><div class="line">            &#125; else &#123;</div><div class="line">                Log.e(TAG, &quot;not found, can not register&quot;);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        @Override</div><div class="line">        public void unregisterListener(OnNewBookArrivedListener listener) throws RemoteException &#123;</div><div class="line">            boolean success = mNewBookArrivedListeners.unregister(listener);</div><div class="line">            if(success) &#123;</div><div class="line">                Log.d(TAG, &quot;unregister success&quot;);</div><div class="line">            &#125; else &#123;</div><div class="line">                Log.e(TAG, &quot;not found, can not unregister&quot;);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    @Nullable</div><div class="line">    @Override</div><div class="line">    public IBinder onBind(Intent intent) &#123;</div><div class="line">        Log.d(TAG, &quot;onBind&quot;);</div><div class="line">        return mBookManager.asBinder();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public boolean onUnbind(Intent intent) &#123;</div><div class="line">        Log.d(TAG, &quot;onUnbind&quot;);</div><div class="line">//        return super.onUnbind(intent);</div><div class="line">        return true; // for invoke onRebind method</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void onRebind(Intent intent) &#123;</div><div class="line">        Log.d(TAG, &quot;onRebind&quot;);</div><div class="line">        super.onRebind(intent);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void onCreate() &#123;</div><div class="line">        Log.d(TAG, &quot;onCreate&quot;);</div><div class="line">        super.onCreate();</div><div class="line">        new Thread(new ServiceWorker()).start();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public int onStartCommand(Intent intent, int flags, int startId) &#123;</div><div class="line">        Log.d(TAG, &quot;onStartCommand&quot;);</div><div class="line">        return super.onStartCommand(intent, flags, startId);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void onDestroy() &#123;</div><div class="line">        Log.d(TAG, &quot;onDestroy&quot;);</div><div class="line">        super.onDestroy();</div><div class="line">        mIsServiceDestoryed.set(true);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    private void onNewBookArrived(Book book) throws RemoteException &#123;</div><div class="line">        Log.d(TAG, &quot;onNewBookArrived&quot;);</div><div class="line">        mBooks.add(book);</div><div class="line">        final int N = mNewBookArrivedListeners.beginBroadcast();</div><div class="line">        for (int i = 0; i &lt; N; i++) &#123;</div><div class="line">            OnNewBookArrivedListener l = mNewBookArrivedListeners.getBroadcastItem(i);</div><div class="line">            if (l != null) &#123;</div><div class="line">                try &#123;</div><div class="line">                    l.onNewBookArrived(book);</div><div class="line">                &#125; catch (RemoteException e) &#123;</div><div class="line">                    e.printStackTrace();</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        mNewBookArrivedListeners.finishBroadcast();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    private class ServiceWorker implements Runnable &#123;</div><div class="line">        @Override</div><div class="line">        public void run() &#123;</div><div class="line">            // do background processing here.....</div><div class="line">            while (!mIsServiceDestoryed.get()) &#123;</div><div class="line">                try &#123;</div><div class="line">                    Thread.sleep(5000);</div><div class="line">                &#125; catch (InterruptedException e) &#123;</div><div class="line">                    e.printStackTrace();</div><div class="line">                &#125;</div><div class="line">                int bookId = mBooks.size() + 1;</div><div class="line">                Book newBook = new Book();</div><div class="line">                newBook.setName(&quot;newBook#&quot; + bookId);</div><div class="line">                newBook.setPrice(100);</div><div class="line">                try &#123;</div><div class="line">                    onNewBookArrived(newBook);</div><div class="line">                &#125; catch (RemoteException e) &#123;</div><div class="line">                    e.printStackTrace();</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>AIDLService是服务端代码，大致可以分为三块：第一块是初始化，在 onCreate() 方法里面我进行了一些数据的初始化操作。第二块是重写 BookManager.Stub 中的方法（在这里面实现AIDL里面定义的方法接口的具体实现逻辑）。第三块是重写 onBind() 方法，在里面返回写好的 BookManager.Stub 。</p>
</blockquote>
<p>接下来在 Manefest 文件里面注册这个我们写好的 Service ：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&lt;service</div><div class="line">    android:name=&quot;.service.AIDLService&quot;</div><div class="line">    android:exported=&quot;true&quot;&gt;</div><div class="line">        &lt;intent-filter&gt;</div><div class="line">            &lt;action android:name=&quot;com.gn100.aidl&quot;/&gt;</div><div class="line">            &lt;category android:name=&quot;android.intent.category.DEFAULT&quot;/&gt;</div><div class="line">        &lt;/intent-filter&gt;</div><div class="line">&lt;/service&gt;</div></pre></td></tr></table></figure>
<h3 id="客户端代码"><a href="#客户端代码" class="headerlink" title="客户端代码"></a>客户端代码</h3><p>前面说过，在客户端我们要完成的工作主要是调用服务端的方法，但是在那之前，我们首先要连接上服务端，完整的客户端代码是这样的：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div></pre></td><td class="code"><pre><div class="line">// AIDLActivity.java</div><div class="line"></div><div class="line">package com.gn100.ipcclient;</div><div class="line"></div><div class="line">import android.content.ComponentName;</div><div class="line">import android.content.Intent;</div><div class="line">import android.content.ServiceConnection;</div><div class="line">import android.os.Bundle;</div><div class="line">import android.os.Handler;</div><div class="line">import android.os.IBinder;</div><div class="line">import android.os.Message;</div><div class="line">import android.os.RemoteException;</div><div class="line">import android.support.v7.app.AppCompatActivity;</div><div class="line">import android.util.Log;</div><div class="line">import android.view.View;</div><div class="line"></div><div class="line">import com.gn100.ipcserver.aidl.Book;</div><div class="line">import com.gn100.ipcserver.aidl.BookManager;</div><div class="line">import com.gn100.ipcserver.aidl.OnNewBookArrivedListener;</div><div class="line"></div><div class="line">import java.util.List;</div><div class="line"></div><div class="line">public class AIDLActivity extends AppCompatActivity implements View.OnClickListener &#123;</div><div class="line"></div><div class="line">    private static final String TAG = AIDLActivity.class.getCanonicalName();</div><div class="line"></div><div class="line">    private BookManager mBookManager;</div><div class="line"></div><div class="line">    private static final int MESSAGE_NEW_BOOK_ARRIVED = 1;</div><div class="line">    private Handler mHandler = new Handler() &#123;</div><div class="line">        @Override</div><div class="line">        public void handleMessage(Message msg) &#123;</div><div class="line">            switch (msg.what) &#123;</div><div class="line">                case MESSAGE_NEW_BOOK_ARRIVED:</div><div class="line">                    Log.d(TAG, &quot;receive new book :&quot; + msg.obj);</div><div class="line">                    break;</div><div class="line">                default:</div><div class="line">                    super.handleMessage(msg);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    private OnNewBookArrivedListener mOnNewBookArrivedListener = new OnNewBookArrivedListener.Stub() &#123;</div><div class="line"></div><div class="line">        @Override</div><div class="line">        public void onNewBookArrived(Book newBook) throws RemoteException &#123;</div><div class="line">            mHandler.obtainMessage(MESSAGE_NEW_BOOK_ARRIVED, newBook)</div><div class="line">                    .sendToTarget();</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    private IBinder.DeathRecipient mDeathRecipient = new IBinder.DeathRecipient() &#123;</div><div class="line">        @Override</div><div class="line">        public void binderDied() &#123;</div><div class="line">            Log.d(TAG, &quot;binder died. tname:&quot; + Thread.currentThread().getName());</div><div class="line">            if (mBookManager == null)</div><div class="line">                return;</div><div class="line">            mBookManager.asBinder().unlinkToDeath(mDeathRecipient, 0);</div><div class="line">            mBookManager = null;</div><div class="line">            // TODO:这里重新绑定远程Service</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    private ServiceConnection mServiceConnection = new ServiceConnection() &#123;</div><div class="line"></div><div class="line">        @Override</div><div class="line">        public void onServiceConnected(ComponentName name, IBinder service) &#123;</div><div class="line">            Log.d(TAG, &quot;onServiceConnected&quot;);</div><div class="line">            mBookManager = BookManager.Stub.asInterface(service);</div><div class="line">            try &#123;</div><div class="line">                Log.i(TAG, &quot;register listener:&quot; + mOnNewBookArrivedListener);</div><div class="line">                mBookManager.registerListener(mOnNewBookArrivedListener);</div><div class="line">                mBookManager.asBinder().linkToDeath(mDeathRecipient, 0);</div><div class="line">            &#125; catch (RemoteException e) &#123;</div><div class="line">                e.printStackTrace();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        @Override</div><div class="line">        public void onServiceDisconnected(ComponentName name) &#123;</div><div class="line">            Log.d(TAG, &quot;onServiceDisconnected. tname:&quot; + Thread.currentThread().getName());</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    protected void onStart() &#123;</div><div class="line">        super.onStart();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    protected void onStop() &#123;</div><div class="line">        super.onStop();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    protected void onDestroy() &#123;</div><div class="line">        super.onDestroy();</div><div class="line">        if (mBookManager != null</div><div class="line">                &amp;&amp; mBookManager.asBinder().isBinderAlive()) &#123;</div><div class="line">            try &#123;</div><div class="line">                Log.i(TAG, &quot;unregister listener:&quot; + mOnNewBookArrivedListener);</div><div class="line">                mBookManager.unregisterListener(mOnNewBookArrivedListener);</div><div class="line">                unbindService(mServiceConnection);</div><div class="line">            &#125; catch (RemoteException e) &#123;</div><div class="line">                e.printStackTrace();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</div><div class="line">        super.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_aidl_service);</div><div class="line"></div><div class="line">        findViewById(R.id.btn_add_book_in).setOnClickListener(this);</div><div class="line">        findViewById(R.id.btn_add_book_out).setOnClickListener(this);</div><div class="line">        findViewById(R.id.btn_add_book_in_out).setOnClickListener(this);</div><div class="line">        findViewById(R.id.btn_get_books).setOnClickListener(this);</div><div class="line"></div><div class="line">        bindService();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void onClick(View v) &#123;</div><div class="line">        switch (v.getId()) &#123;</div><div class="line">            case R.id.btn_add_book_in:</div><div class="line">                addBookIn();</div><div class="line">                break;</div><div class="line">            case R.id.btn_add_book_out:</div><div class="line">                addBookOut();</div><div class="line">                break;</div><div class="line">            case R.id.btn_add_book_in_out:</div><div class="line">                addBookInout();</div><div class="line">                break;</div><div class="line">            case R.id.btn_get_books:</div><div class="line">                getBooks();</div><div class="line">                break;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    private void addBookIn() &#123;</div><div class="line">        new Thread(new Runnable() &#123;</div><div class="line">            @Override</div><div class="line">            public void run() &#123;</div><div class="line">                try &#123;</div><div class="line">                    Book book = new Book();</div><div class="line">                    book.setName(&quot;Android築基篇&quot;);</div><div class="line">                    book.setPrice(199);</div><div class="line">                    Log.d(TAG, &quot;book info addBookIn before : &quot; + book);</div><div class="line">                    mBookManager.addBookIn(book);</div><div class="line">                    Log.d(TAG, &quot;book info addBookIn after : &quot; + book);</div><div class="line">                &#125; catch (RemoteException e) &#123;</div><div class="line">                    e.printStackTrace();</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;).start();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    private void addBookOut() &#123;</div><div class="line">        new Thread(new Runnable() &#123;</div><div class="line">            @Override</div><div class="line">            public void run() &#123;</div><div class="line">                Book book = new Book();</div><div class="line">                book.setName(&quot;Android築基篇&quot;);</div><div class="line">                book.setPrice(199);</div><div class="line">                try &#123;</div><div class="line">                    Log.d(TAG, &quot;book info addBookOut before : &quot; + book);</div><div class="line">                    mBookManager.addBookOut(book);</div><div class="line">                    Log.d(TAG, &quot;book info addBookOut after : &quot; + book);</div><div class="line">                &#125; catch (RemoteException e) &#123;</div><div class="line">                    e.printStackTrace();</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    private void addBookInout() &#123;</div><div class="line">        new Thread(new Runnable() &#123;</div><div class="line">            @Override</div><div class="line">            public void run() &#123;</div><div class="line">                Book book = new Book();</div><div class="line">                book.setName(&quot;Android築基篇&quot;);</div><div class="line">                book.setPrice(199);</div><div class="line">                try &#123;</div><div class="line">                    Log.d(TAG, &quot;book info addBookInout before : &quot; + book);</div><div class="line">                    mBookManager.addBookInout(book);</div><div class="line">                    Log.d(TAG, &quot;book info addBookInout after : &quot; + book);</div><div class="line">                &#125; catch (RemoteException e) &#123;</div><div class="line">                    e.printStackTrace();</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    private void getBooks() &#123;</div><div class="line">        new Thread(new Runnable() &#123;</div><div class="line">            @Override</div><div class="line">            public void run() &#123;</div><div class="line">                try &#123;</div><div class="line">                    List&lt;Book&gt; books = mBookManager.getBooks();</div><div class="line">                    Log.d(TAG, &quot;books info = &quot; + books.toString());</div><div class="line">                &#125; catch (RemoteException e) &#123;</div><div class="line">                    e.printStackTrace();</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    private void bindService() &#123;</div><div class="line">        Intent intent = new Intent();</div><div class="line">        intent.setAction(&quot;com.gn100.aidl&quot;);</div><div class="line">        intent.setPackage(&quot;com.gn100.ipcserver&quot;);</div><div class="line">        bindService(intent, mServiceConnection, BIND_AUTO_CREATE);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>AIDLActivity 是客户端代码，首先bindService建立连接，然后在 ServiceConnection 里面获取 BookManager 对象，接着通过它来调用服务端的方法。</p>
</blockquote>
<h2 id="3、注意事项"><a href="#3、注意事项" class="headerlink" title="3、注意事项"></a>3、注意事项</h2><ol>
<li>在使用AIDL进行跨进程通信时，在调用远程进程方法时，尽量在子线程处理，避免远程进程方法做了耗时操作，阻塞自己的UI线程。</li>
<li>服务端需要处理并发问题。</li>
</ol>
<h1 id="四、AIDL工作原理"><a href="#四、AIDL工作原理" class="headerlink" title="四、AIDL工作原理"></a>四、AIDL工作原理</h1><p><img src="/images/Android/Binder_Work_Mechanism.png" alt="AIDL工作原理"></p>
<h1 id="五、AIDL结构类图"><a href="#五、AIDL结构类图" class="headerlink" title="五、AIDL结构类图"></a>五、AIDL结构类图</h1><p><img src="/images/Android/AIDL_Class_Diagram.png" alt="AIDL结构类图"></p>
<h1 id="代码地址"><a href="#代码地址" class="headerlink" title="代码地址"></a>代码地址</h1><blockquote>
<p><a href="https://github.com/atopom/android_first_draft/tree/master/Code/IPC%E9%80%9A%E4%BF%A1" target="_blank" rel="external">https://github.com/atopom/android_first_draft/tree/master/Code/IPC%E9%80%9A%E4%BF%A1</a></p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2015/03/12/android/2015-3-12-Android-IPC-Messenger/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="王亚楠">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Atopom博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2015/03/12/android/2015-3-12-Android-IPC-Messenger/" itemprop="url">Android-IPC-Messenger</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-03-12T16:38:10+08:00">
                2015-03-12
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Messenger信使"><a href="#Messenger信使" class="headerlink" title="Messenger信使"></a>Messenger信使</h1><blockquote>
<p>官方文档解释：它引用了一个Handler对象，以便others能够向它发送消息(使用mMessenger.send(Message msg)方法)。该类允许跨进程间基于Message通信(即两个进程间可以通过Message进行通信)。简单理解，就是在服务端使用Handler创建一个Messenger，客户端持有这个Messenger就可以与服务端通信了。</p>
</blockquote>
<p>以前我们使用Handler+Message的方式进行通信，都是在同一个进程中，从线程持有一个主线程的Handler对象，并向主线程发送消息。</p>
<p>Android可以使用binder机制进行跨进行通信，所以我们就可以将Handler与binder结合起来进行跨进程发送消息。查看API就可以发现，Messenger就是通过这种方式的实现。</p>
<p>一般使用方法如下：</p>
<ol>
<li><p>远程通过 mMessenger = new Messenger(mHandler) 创建一个信使对象</p>
</li>
<li><p>客户端使用 binderService 请求连接远程</p>
</li>
<li><p>远程 onBind 方法返回一个binder</p>
<blockquote>
<p>return mMessenger.getBinder();</p>
</blockquote>
</li>
<li><p>客户端使用远程返回的binder得到一个信使（即得到远程信使）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">public void onServiceConnected(ComponentName name, IBinder service) &#123;</div><div class="line">     rMessenger = new Messenger(service);    </div><div class="line">     ......</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ol>
<p>这里虽然是new了一个Messenger，但我们查看它的实现<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">public Messenger(IBinder target) &#123; mTarget = IMessenger.Stub.asInterface(target); &#125;</div></pre></td></tr></table></figure></p>
<p>发现它的mTarget是通过AIDL得到的，实际上就是远程创建的那个。</p>
<ol>
<li>客户端可以使用这个远程信使对象向远程发送消息：<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rMessenger.send(msg);</div></pre></td></tr></table></figure>
</li>
</ol>
<p>这样远程服务端的Handler对象就能收到消息了，然后可以在其handlerMessage(Message msg)方法中进行处理。（该Handler对象就是第一步服务端创建Messenger时使用的参数mHandler）。</p>
<p>经过这5个步骤貌似只有客户端向服务端发送消息，这样的消息传递是单向的，那么如何实现双向传递呢？</p>
<p>首先需要在第5步稍加修改，在send(msg)前通过msm.replyTo = mMessenger将自己的信使设置到消息中，这样服务端接收到消息时同时也得到了客户端的信使对象了，然后服务端可以通过得到客户端的信使对象，并向它发送消息。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">cMessenger = msg.replyTo;</div><div class="line">cMessenger.send(message);</div></pre></td></tr></table></figure></p>
<p>即完成了从服务端向客户端发送消息的功能，这样客服端可以在自己的Handler对象的handlerMessage方法中接收服务端发送来的message进行处理。</p>
<p>双向通信宣告完成。</p>
<h1 id="Messenger工作原理"><a href="#Messenger工作原理" class="headerlink" title="Messenger工作原理"></a>Messenger工作原理</h1><p><img src="/images/Android/Messenger_Work_Principle.png" alt="Messenger的工作原理"></p>
<h1 id="以下代码来自ApiDemo"><a href="#以下代码来自ApiDemo" class="headerlink" title="以下代码来自ApiDemo"></a>以下代码来自ApiDemo</h1><p>Service code:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div></pre></td><td class="code"><pre><div class="line">public class MessengerService extends Service &#123;  </div><div class="line">    /** For showing and hiding our notification. */  </div><div class="line">    NotificationManager mNM;  </div><div class="line">    /** Keeps track of all current registered clients. */  </div><div class="line">    ArrayList&lt;Messenger&gt; mClients = new ArrayList&lt;Messenger&gt;();  </div><div class="line">    /** Holds last value set by a client. */  </div><div class="line">    int mValue = 0;  </div><div class="line"></div><div class="line">    /**</div><div class="line">     * Command to the service to register a client, receiving callbacks</div><div class="line">     * from the service.  The Message&apos;s replyTo field must be a Messenger of</div><div class="line">     * the client where callbacks should be sent.</div><div class="line">     */  </div><div class="line">    static final int MSG_REGISTER_CLIENT = 1;  </div><div class="line"></div><div class="line">    /**</div><div class="line">     * Command to the service to unregister a client, ot stop receiving callbacks</div><div class="line">     * from the service.  The Message&apos;s replyTo field must be a Messenger of</div><div class="line">     * the client as previously given with MSG_REGISTER_CLIENT.</div><div class="line">     */  </div><div class="line">    static final int MSG_UNREGISTER_CLIENT = 2;  </div><div class="line"></div><div class="line">    /**</div><div class="line">     * Command to service to set a new value.  This can be sent to the</div><div class="line">     * service to supply a new value, and will be sent by the service to</div><div class="line">     * any registered clients with the new value.</div><div class="line">     */  </div><div class="line">    static final int MSG_SET_VALUE = 3;  </div><div class="line"></div><div class="line">    /**</div><div class="line">     * Handler of incoming messages from clients.</div><div class="line">     */  </div><div class="line">    class IncomingHandler extends Handler &#123;  </div><div class="line">        @Override  </div><div class="line">        public void handleMessage(Message msg) &#123;  </div><div class="line">            switch (msg.what) &#123;  </div><div class="line">                case MSG_REGISTER_CLIENT:  </div><div class="line">                    mClients.add(msg.replyTo);  </div><div class="line">                    break;  </div><div class="line">                case MSG_UNREGISTER_CLIENT:  </div><div class="line">                    mClients.remove(msg.replyTo);  </div><div class="line">                    break;  </div><div class="line">                case MSG_SET_VALUE:  </div><div class="line">                    mValue = msg.arg1;  </div><div class="line">                    for (int i = mClients.size() - 1; i &gt;= 0; i --) &#123;  </div><div class="line">                        try &#123;  </div><div class="line">                            mClients.get(i).send(Message.obtain(null,  </div><div class="line">                                    MSG_SET_VALUE, mValue, 0));  </div><div class="line">                        &#125; catch (RemoteException e) &#123;  </div><div class="line">                            // The client is dead.  Remove it from the list;   </div><div class="line">                            // we are going through the list from back to front   </div><div class="line">                            // so this is safe to do inside the loop.   </div><div class="line">                            mClients.remove(i);  </div><div class="line">                        &#125;  </div><div class="line">                    &#125;  </div><div class="line">                    break;  </div><div class="line">                default:  </div><div class="line">                    super.handleMessage(msg);  </div><div class="line">            &#125;  </div><div class="line">        &#125;  </div><div class="line">    &#125;  </div><div class="line"></div><div class="line">    /**</div><div class="line">     * Target we publish for clients to send messages to IncomingHandler.</div><div class="line">     */  </div><div class="line">    final Messenger mMessenger = new Messenger(new IncomingHandler());  </div><div class="line"></div><div class="line">    @Override  </div><div class="line">    public void onCreate() &#123;  </div><div class="line">        mNM = (NotificationManager)getSystemService(NOTIFICATION_SERVICE);  </div><div class="line"></div><div class="line">        // Display a notification about us starting.   </div><div class="line">        showNotification();  </div><div class="line">    &#125;  </div><div class="line"></div><div class="line">    @Override  </div><div class="line">    public void onDestroy() &#123;  </div><div class="line">        // Cancel the persistent notification.   </div><div class="line">        mNM.cancel(R.string.remote_service_started);  </div><div class="line"></div><div class="line">        // Tell the user we stopped.   </div><div class="line">        Toast.makeText(this, R.string.remote_service_stopped, Toast.LENGTH_SHORT).show();  </div><div class="line">    &#125;  </div><div class="line"></div><div class="line">    /**</div><div class="line">     * When binding to the service, we return an interface to our messenger</div><div class="line">     * for sending messages to the service.</div><div class="line">     */  </div><div class="line">    @Override  </div><div class="line">    public IBinder onBind(Intent intent) &#123;  </div><div class="line">        return mMessenger.getBinder();  </div><div class="line">    &#125;  </div><div class="line"></div><div class="line">    /**</div><div class="line">     * Show a notification while this service is running.</div><div class="line">     */  </div><div class="line">    private void showNotification() &#123;  </div><div class="line">        // In this sample, we&apos;ll use the same text for the ticker and the expanded notification   </div><div class="line">        CharSequence text = getText(R.string.remote_service_started);  </div><div class="line"></div><div class="line">        // Set the icon, scrolling text and timestamp   </div><div class="line">        Notification notification = new Notification(R.drawable.stat_sample, text,  </div><div class="line">                System.currentTimeMillis());  </div><div class="line"></div><div class="line">        // The PendingIntent to launch our activity if the user selects this notification   </div><div class="line">        PendingIntent contentIntent = PendingIntent.getActivity(this, 0,  </div><div class="line">                new Intent(this, Controller.class), 0);  </div><div class="line"></div><div class="line">        // Set the info for the views that show in the notification panel.   </div><div class="line">        notification.setLatestEventInfo(this, getText(R.string.remote_service_label),  </div><div class="line">                       text, contentIntent);  </div><div class="line"></div><div class="line">        // Send the notification.   </div><div class="line">        // We use a string id because it is a unique number.  We use it later to cancel.   </div><div class="line">        mNM.notify(R.string.remote_service_started, notification);  </div><div class="line">    &#125;  </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h1 id="自己的DEMO："><a href="#自己的DEMO：" class="headerlink" title="自己的DEMO："></a>自己的DEMO：</h1><ol>
<li><p>MyActivity Code</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div></pre></td><td class="code"><pre><div class="line">public class MyActivity extends Activity &#123;</div><div class="line"></div><div class="line">    protected static final int HELLO_CLIENT = 0;</div><div class="line">    private MyServiceConnection conn;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</div><div class="line">        super.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_main);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    protected void onStart() &#123;</div><div class="line">        super.onStart();</div><div class="line">        Intent service = new Intent(this, MyService.class);</div><div class="line">        conn = new MyServiceConnection();</div><div class="line">        bindService(service, conn, BIND_AUTO_CREATE);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    protected void onDestroy() &#123;</div><div class="line">        super.onDestroy();</div><div class="line">        unbindService(conn);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public boolean onCreateOptionsMenu(Menu menu) &#123;</div><div class="line">        // Inflate the menu; this adds items to the action bar if it is present.</div><div class="line">        getMenuInflater().inflate(R.menu.main, menu);</div><div class="line">        return true;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    private Handler handler = new Handler() &#123;</div><div class="line">        public void handleMessage(Message msg) &#123;</div><div class="line">            switch(msg.what) &#123;</div><div class="line">            case HELLO_CLIENT:</div><div class="line">                Log.d(&quot;wangyanan&quot;, &quot;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; hello client &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&quot;);</div><div class="line">                break;</div><div class="line">            &#125;</div><div class="line">        &#125;;</div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    private Messenger clientMessenger;</div><div class="line">    private Messenger serviceMessenger;</div><div class="line"></div><div class="line">    class MyServiceConnection implements ServiceConnection &#123;</div><div class="line"></div><div class="line">        @Override</div><div class="line">        public void onServiceConnected(ComponentName name, IBinder service) &#123;</div><div class="line"></div><div class="line">            clientMessenger = new Messenger(handler);</div><div class="line">            serviceMessenger = new Messenger(service);</div><div class="line">            sendServiceMessage(MyService.HELLO_SERVICE);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        @Override</div><div class="line">        public void onServiceDisconnected(ComponentName name) &#123;</div><div class="line"></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void sendServiceMessage(int what) &#123;</div><div class="line">        try &#123;</div><div class="line">            Message message = Message.obtain(null, MyService.HELLO_SERVICE);</div><div class="line">            message.replyTo = clientMessenger;</div><div class="line">            serviceMessenger.send(message);</div><div class="line">        &#125; catch (RemoteException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">            Toast.makeText(MyActivity.this, &quot;与服务器连接失败&quot;, Toast.LENGTH_SHORT).show();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>MyService Code</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line">public class MyService extends Service &#123;</div><div class="line"></div><div class="line">    protected static final int HELLO_SERVICE = 0;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public IBinder onBind(Intent intent) &#123;</div><div class="line">        Log.d(&quot;wangyanan&quot;, &quot;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; MyService onBind......&quot;);</div><div class="line">        return serviceMessenger.getBinder();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public int onStartCommand(Intent intent, int flags, int startId) &#123;</div><div class="line">        Log.d(&quot;wangyanan&quot;, &quot;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; MyService onStartComand......&quot;);</div><div class="line">        return super.onStartCommand(intent, flags, startId);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    private Handler handler = new Handler() &#123;</div><div class="line"></div><div class="line">        public void handleMessage(Message msg) &#123;</div><div class="line"></div><div class="line">            switch(msg.what) &#123;</div><div class="line">            case HELLO_SERVICE:</div><div class="line">                Log.d(&quot;wangyanan&quot;, &quot;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; hello service &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&quot;);</div><div class="line">                clientMessenger = msg.replyTo;</div><div class="line">                sendClientMessage(MyActivity.HELLO_CLIENT);</div><div class="line">                break;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    private Messenger serviceMessenger = new Messenger(handler);</div><div class="line">    private Messenger clientMessenger = new Messenger(handler);</div><div class="line"></div><div class="line">    private void sendClientMessage(int what) &#123;</div><div class="line">        try &#123;</div><div class="line">            Message message = Message.obtain(null, what);</div><div class="line">            clientMessenger.send(message);</div><div class="line">        &#125; catch (RemoteException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>Log打印结果</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">07-27 10:46:54.049: D/wangyanan(8876): &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; MyService onBind......</div><div class="line">07-27 10:46:54.220: D/wangyanan(8876): &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; hello service &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</div><div class="line">07-27 10:46:54.220: D/wangyanan(8876): &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; hello client &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</div></pre></td></tr></table></figure>
</li>
</ol>
<h1 id="代码地址"><a href="#代码地址" class="headerlink" title="代码地址"></a>代码地址</h1><blockquote>
<p><a href="https://github.com/atopom/android_first_draft/tree/master/Code/IPC%E9%80%9A%E4%BF%A1" target="_blank" rel="external">https://github.com/atopom/android_first_draft/tree/master/Code/IPC%E9%80%9A%E4%BF%A1</a></p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2015/02/12/objectc/2015-2-12-OC-DataType/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="王亚楠">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Atopom博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2015/02/12/objectc/2015-2-12-OC-DataType/" itemprop="url">Object-C－DataType</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-02-12T18:28:37+08:00">
                2015-02-12
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Object-C/" itemprop="url" rel="index">
                    <span itemprop="name">Object-C</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>数据类型，是每门开发语言的基本必修课，下面是为自己总结回顾使用的，分享给大家。如有错误请指正，交流学习，共同进步，谢谢～</p>
</blockquote>
<h1 id="基本数据类型"><a href="#基本数据类型" class="headerlink" title="基本数据类型"></a>基本数据类型</h1><h2 id="int类型"><a href="#int类型" class="headerlink" title="int类型"></a>int类型</h2><p>八进制 以0开头的整型<br>NSLog的格式符：<br>％o 显示的八进制不带前导0<br>％#o 显示的八进制带前导0  </p>
<p>十六进制 以0x开头的整型<br>NSLog的格式符：<br>％x 显示的十六进制不带前导0x<br>％#x 显示的十六进制带签到0x<br>％X、％#X 显示的十六进制是大写  </p>
<h2 id="float类型"><a href="#float类型" class="headerlink" title="float类型"></a>float类型</h2><p>NSLog的格式符：％f<br>％e 科学技术法显示值<br>％g 指数的值小于-4 大 于5，采用％e，否则采用％f  </p>
<p>十六进制的浮点常量包含前导 0x 或 0X，后面紧跟一个或多个十进制或十六进制数字，再后是 p 或 P，最后是可以带符号的二进制指数。<br>例:0x0.3p10 表示的值为 3/16*2^10<br>注:若无特殊说明，Object-c 将所有的浮点常量看做 double 值，要显示 double 值可使用和 float 一样的格式符。  </p>
<h2 id="char类型"><a href="#char类型" class="headerlink" title="char类型"></a>char类型</h2><p>NSLog的格式符:%c<br>long double 常量写成尾部带有字母 l 或者 L 的浮点常量。1.234e+7L  </p>
<p><img src="/images/OC/OC-Int-NSLog-Format-Character.png" alt=""></p>
<p>注:id类型可以通过类型转化符可以将一般的id类型的对象转换成特定的对象。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">_Bool 处理 Boolean(即 0 或 1)  </div><div class="line">_Complex 处理复数  </div><div class="line">_Imaginary 处理抽象数字</div></pre></td></tr></table></figure>
<p>实例变量的初始化值默认为 0<br>实例变量作用域的指令:<br>@private 实例变量可被定义在该类的方法直接访问，不能被子类定义的方法直接访问。<br>@package 对于 64 位图像，可以在实现该类的图像的任何地方访问这个实例变量。<br>@protected 实例变量可被该类及任何子类中定义的方法直接访问(默认的情况)。<br>@public 实例变量可被该类中定义的方法直接访问，也可被其他类或模块中定义的方法访问。使得其他方法或函数可以通过(-&gt;)来访问实例变量(不推荐用)。  </p>
<p>在类中定义静态变量<br>说明符voaltile和const正好相反，明确告诉编译器，指定类型变量的值会改变。(I/O端口)<br>比如要将输出端口的地址存储在 outPort 的变量中。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">volatile char *outPort;  </div><div class="line">*outPort = &apos;O&apos;;  </div><div class="line">*outPort = &apos;N&apos;;</div></pre></td></tr></table></figure>
<p>这样就可以避免编译器将第一个赋值语句从程序中删除。  </p>
<h2 id="BOOL类型"><a href="#BOOL类型" class="headerlink" title="BOOL类型"></a>BOOL类型</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">typedef signed char BOOL;</div><div class="line">#define YES (BOOL)1;</div><div class="line">#define NO (BOOL)0;</div></pre></td></tr></table></figure>
<h1 id="nil空类型"><a href="#nil空类型" class="headerlink" title="nil空类型"></a>nil空类型</h1><p>也就是C中的NULL，也就是0;  </p>
<h1 id="NSNumber类型"><a href="#NSNumber类型" class="headerlink" title="NSNumber类型"></a>NSNumber类型</h1><p>可以使用对象来封装基本数值。<br>NSNumber 类来包装基本数据类型。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">+ (NSNumber *)numberWithChar :(char)value;</div><div class="line">+ (NSNumber *)numberWithInt :(int)value;</div><div class="line">+ (NSNumber *)numberWithFloat :(float)value;</div><div class="line">+ (NSNumber *)numberWithBool :(BOOL)value;</div></pre></td></tr></table></figure>
<p>还有包括无符号版本和各种 long 型数据及 long long 整型数据<br>例如:  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">NSNumber *number = [NSNumber numberWithInt :42];</div></pre></td></tr></table></figure>
<p>将一个基本类型封装到 NSNumber 后,可以使用下列方法重新获得:  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">- (char)charValue;</div><div class="line">- (int)intValue;</div><div class="line">- (float)floatValue;</div><div class="line">- (BOOL)boolValue;</div><div class="line">- (NSString *)stringValue;</div></pre></td></tr></table></figure>
<h1 id="NSValue类型"><a href="#NSValue类型" class="headerlink" title="NSValue类型"></a>NSValue类型</h1><p>NSNumber 实际上是 NSValue的子类, NSValue可以封装任意值。可以用NSValue将结构放入 NSArray 和 NSDictionary 中。  </p>
<p>创建新的 NSValue:  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">+(NSValue*)valueWithBytes:(const void *) value objCType:(const char *)type;</div></pre></td></tr></table></figure>
<p>@encode 编译器指令可以接受数据类型的名称并为你生成合适的字符串。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">NSRect rect = NSMakeRect(1,2,30,40);</div><div class="line">NSValue *value;</div><div class="line">value = [NSValuevalueWithBytes:&amp;rect objCType:@encode(NSRect)];</div></pre></td></tr></table></figure>
<p>使用getValue:来提取数值 (传递的是要存储这个数值的变量的地址)(先找地址再取值)  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">value = [array objectAtIndex : 0];</div><div class="line">[value getValue:&amp;rect];</div></pre></td></tr></table></figure>
<p>注:Cocoa 提供了将常用的 struct 型数据转化成 NSValue 的便捷方法:  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">+ (NSValue*)valueWithPoint:(NSPoint)point;</div><div class="line">+ (NSValue*)valueWithSize:(NSSize)size;</div><div class="line">+ (NSValue*)valueWithRect:(NSRect)rect;</div><div class="line">- (NSSize)sizeValue;</div><div class="line">- (NSRect)rectValue;</div><div class="line">- (NSPoint)pointValue;</div></pre></td></tr></table></figure>
<h1 id="NSNull类型"><a href="#NSNull类型" class="headerlink" title="NSNull类型"></a>NSNull类型</h1><p>在关键字下如果属性是NSNull表明没有这个属性，没有数值的话表明不知道是否有这个属性。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[NSNull null] //总返回一样的值</div><div class="line">+ (NSNull *)null;</div></pre></td></tr></table></figure>
<p>例如:  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[contast setObject:[NSNull null] forKey:@&quot;home&quot;];</div></pre></td></tr></table></figure>
<p>访问它:  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">id home = [contast objectForKey:@&quot;home&quot;];</div><div class="line">if (home==[NSNullnull])&#123;</div><div class="line">...</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="NSFileManager类型"><a href="#NSFileManager类型" class="headerlink" title="NSFileManager类型"></a>NSFileManager类型</h1><p>允许对文件系统进行操作(创建目录、删除文件、移动文件或获取文件信息)<br>创建一个属于自己的 NSFileManager 对象  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">NSFileManager *manager = [NSFileManager defaultManager] ;</div></pre></td></tr></table></figure>
<p>将代字符‘~’替换成主目录  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">NSString *home = [@&quot;~&quot; stringByExpandingTildeInPath];</div><div class="line">//输出文件的扩展名</div><div class="line">- (NSString*) pathExtension</div></pre></td></tr></table></figure>
<p>示例:翻查主目录,查找.jpg 文件并输出找到的文件列表  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">#import &lt;Foundation/Foundation.h&gt;</div><div class="line">int main (int argc, const char* argv[]) &#123;</div><div class="line">	NSAutoreleasePool *pool = [[NSAutoreleasePool alloc] init];</div><div class="line">	NSFileManager *manager;</div><div class="line">	manager = [NSFileManager defaultManager];</div><div class="line">	NSString *home;</div><div class="line">	home = [@&quot;~&quot; stringByExpandingTildeInPath];</div><div class="line">	NSDirectoryEnumerator *direnum;</div><div class="line">	direnum = [manager enumeratorAtPath: home];</div><div class="line">	NSMutableArray *files;</div><div class="line">	files = [NSMutableArray arrayWithCapacity:100];</div><div class="line">	NSString *filename;</div><div class="line">	while (filename = [direnum nextObject]) &#123;</div><div class="line">		if ([[filename pathExtension] isEqualTo:@&quot;jpg&quot;]) &#123;</div><div class="line">			[files addObject: filename];</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	NSEnumerator *fileenum;</div><div class="line">	fileenum = [files objectEnumerator];</div><div class="line">	while (filename = [fileenum nextObject]) &#123;</div><div class="line">		NSLog (@&quot;%@&quot;, filename);</div><div class="line">	&#125;</div><div class="line">	[pool drain];</div><div class="line">	return 0;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2015/02/07/2015-2-7-Xcode-Program-Common-ShortcutKey/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="王亚楠">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Atopom博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2015/02/07/2015-2-7-Xcode-Program-Common-ShortcutKey/" itemprop="url">Xcode常用快捷键</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-02-07T18:28:37+08:00">
                2015-02-07
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Xcode/" itemprop="url" rel="index">
                    <span itemprop="name">Xcode</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>工欲善其事，必先利其器。<br>想要更畅快的开发，熟悉常用快捷键那时必不可少的。<br>内容会持续更新，如有错误，请指正，谢谢～。</p>
</blockquote>
<h1 id="Command组合"><a href="#Command组合" class="headerlink" title="Command组合"></a>Command组合</h1><blockquote>
<p>Command+R:表示Run Project<br>Command+B:表示Build Project<br>Command+]:表示缩紧<br>Command+[:表示反向缩紧<br>Command+Del:表示删除一行<br>Command+T:表示新建Tab<br>Command+0:表示隐藏／显示 工程左侧导航<br>Command+1:表示隐藏／显示 工程左侧导航tab1 文件导航器<br>Command+2:表示隐藏／显示 工程左侧导航tab2<br>Command+3:表示隐藏／显示 工程左侧导航tab3 搜索导航器<br>Command+~:表示隐藏／显示 工程底部导航  </p>
</blockquote>
<h1 id="Command＋Option组合"><a href="#Command＋Option组合" class="headerlink" title="Command＋Option组合"></a>Command＋Option组合</h1><blockquote>
<p>Command+Option+0:表示隐藏／显示 工程右侧导航<br>Command+Option+⬅:表示折叠代码块<br>Command+Option+[]:表示上下两行代码交换<br>Command+Option+F:表示查询替换当前文件的指定内容  </p>
</blockquote>
<h1 id="Command＋Shift组合"><a href="#Command＋Shift组合" class="headerlink" title="Command＋Shift组合"></a>Command＋Shift组合</h1><blockquote>
<p>Command+Shift+0:表示打开文档<br>Command+Shift+K:表示Clean Project<br>Command+Shift+F:表示隐藏／显示 工程右侧导航tab3 搜索导航器<br>Command+Shift+O:表示打开包含指定方法或代码的文件<br>Command+Shift+[]:表示XcodeTab页的切换  </p>
</blockquote>
<h1 id="Command＋Control组合"><a href="#Command＋Control组合" class="headerlink" title="Command＋Control组合"></a>Command＋Control组合</h1><blockquote>
<p>Command+Control+⬆:表示oc或c++的.h和.m文件之间的切换<br>Command+Control+⬅:表示返回上次操作的历史位置<br>Command+Control+Y:debug模式全速执行代码<br>Command+Control+E:重命名选中的变量名  </p>
</blockquote>
<h1 id="Option组合"><a href="#Option组合" class="headerlink" title="Option组合"></a>Option组合</h1><blockquote>
<p>Option+Left-Click-File:表示在辅助编辑器中打开文件<br>Option+Left-Click-方法名/类名:表示快速查看文档<br>Option+Del:表示删除一个单词  </p>
</blockquote>
<h1 id="Control组合"><a href="#Control组合" class="headerlink" title="Control组合"></a>Control组合</h1><blockquote>
<p>Control+6:表示跳转到当前文件的某一代码行<br>Control+.:自动匹配<br>Control+/或Tab:表示参数切换  </p>
</blockquote>
<h1 id="Command-Option-Shift组合"><a href="#Command-Option-Shift组合" class="headerlink" title="Command+Option+Shift组合"></a>Command+Option+Shift组合</h1><blockquote>
<p>Command+Option+Shift+Left-Click-File:表示在指定位置打开文件      </p>
</blockquote>
<h1 id="debug"><a href="#debug" class="headerlink" title="debug"></a>debug</h1><blockquote>
<p>fn+F6:表示下一行<br>fn+F7:表示进入方法内部<br>fn+F8:表示跳出方法  </p>
</blockquote>
<h1 id="添加标记语法"><a href="#添加标记语法" class="headerlink" title="添加标记语法"></a>添加标记语法</h1><blockquote>
<p>#pragam mark - mark content</p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2015/01/10/2015-1-10-Markdown-Grammar/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="王亚楠">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Atopom博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2015/01/10/2015-1-10-Markdown-Grammar/" itemprop="url">学习使用Markdown语法</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-01-10T21:28:37+08:00">
                2015-01-10
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Markdown/" itemprop="url" rel="index">
                    <span itemprop="name">Markdown</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>Markdown语法在简书上分分钟实现效果，在github有一丁点错误都不行，整理了好长时间，总算正确显示出来了。  </p>
</blockquote>
<h2 id="分割线"><a href="#分割线" class="headerlink" title="分割线"></a>分割线</h2><p>源码  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">***</div></pre></td></tr></table></figure>
<p>效果  </p>
<hr>
<h2 id="无序文本"><a href="#无序文本" class="headerlink" title="无序文本"></a>无序文本</h2><p>源码  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">- 文本</div><div class="line">- 文本</div><div class="line">- 文本</div></pre></td></tr></table></figure>
<p>效果  </p>
<ul>
<li>文本</li>
<li>文本</li>
<li>文本</li>
</ul>
<h2 id="有序文本"><a href="#有序文本" class="headerlink" title="有序文本"></a>有序文本</h2><p>源码  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">1. 文本</div><div class="line">2. 文本</div><div class="line">3. 文本</div></pre></td></tr></table></figure>
<p>效果  </p>
<ol>
<li>文本</li>
<li>文本</li>
<li>文本</li>
</ol>
<h2 id="链接"><a href="#链接" class="headerlink" title="链接"></a>链接</h2><p>源码  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[简书](http://jianshu.io)</div></pre></td></tr></table></figure>
<p>效果  </p>
<p><a href="http://jianshu.io" target="_blank" rel="external">简书</a></p>
<h2 id="图片"><a href="#图片" class="headerlink" title="图片"></a>图片</h2><p>源码  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">![](http://upload-images.jianshu.io/upload_images/1623602-de31fc2f960b360c.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)</div></pre></td></tr></table></figure>
<p>效果  </p>
<p><img src="http://upload-images.jianshu.io/upload_images/1623602-de31fc2f960b360c.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h2 id="单句引用"><a href="#单句引用" class="headerlink" title="单句引用"></a>单句引用</h2><p>源码  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&gt; 一盏灯， 一片昏黄； 一简书， 一杯淡茶。 守着那一份淡定， 品读属于自己的寂寞。 保持淡定， 才能欣赏到最美丽的风景！ 保持淡定， 人生从此不再寂寞。</div></pre></td></tr></table></figure>
<p>效果  </p>
<blockquote>
<p>一盏灯， 一片昏黄； 一简书， 一杯淡茶。 守着那一份淡定， 品读属于自己的寂寞。 保持淡定， 才能欣赏到最美丽的风景！ 保持淡定， 人生从此不再寂寞。</p>
</blockquote>
<h2 id="多句引用"><a href="#多句引用" class="headerlink" title="多句引用"></a>多句引用</h2><p>源码  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt; 朝辞白帝彩云间  </div><div class="line">&gt; 千里江陵一日还  </div><div class="line">&gt; 两岸猿声啼不住  </div><div class="line">&gt; 轻舟已过万重山</div></pre></td></tr></table></figure>
<p>效果  </p>
<blockquote>
<p>朝辞白帝彩云间<br>千里江陵一日还<br>两岸猿声啼不住<br>轻舟已过万重山  </p>
</blockquote>
<h2 id="粗体和斜体"><a href="#粗体和斜体" class="headerlink" title="粗体和斜体"></a>粗体和斜体</h2><p>源码  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">*斜体*</div><div class="line">**粗体**</div></pre></td></tr></table></figure>
<p>效果  </p>
<p><em>斜体</em><br><strong>粗体</strong></p>
<h2 id="代码块"><a href="#代码块" class="headerlink" title="代码块"></a>代码块</h2><p>源码  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">```</div></pre></td></tr></table></figure>
<pre><code>代码块
代码块
代码块
</code></pre>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">```</div><div class="line"></div><div class="line">效果</div></pre></td></tr></table></figure>
<p>  代码块<br>  代码块<br>  代码块<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">目录级关系（在某些环境不起作用）</div><div class="line">---------</div><div class="line">源码</div></pre></td></tr></table></figure></p>
<pre><code>+ 个人收藏
    + AirDrop
    + iCloub Drive
    - 文档
        - 书籍
            + 程序员修炼之道：从小工到专家
            + 编程珠玑
            - 算法导论
        + 笔记
        + 稿件
</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">效果  </div><div class="line"></div><div class="line">+ 个人收藏</div><div class="line">    + AirDrop</div><div class="line">    + iCloub Drive</div><div class="line">    - 文档</div><div class="line">        - 书籍</div><div class="line">            + 程序员修炼之道：从小工到专家</div><div class="line">            + 编程珠玑</div><div class="line">            + 算法导论</div><div class="line">        + 笔记</div><div class="line">        + 稿件</div><div class="line"></div><div class="line">引用多层级关系</div><div class="line">---------</div><div class="line">源码</div></pre></td></tr></table></figure>
<blockquote>
<p>一级引用</p>
<blockquote>
<p>二级引用</p>
<blockquote>
<p>三级引用<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">效果  </div><div class="line"></div><div class="line">&gt; 一级引用</div><div class="line"></div><div class="line">&gt;&gt; 二级引用</div><div class="line"></div><div class="line">&gt;&gt;&gt; 三级引用</div><div class="line"></div><div class="line">标题语法</div><div class="line">---------</div><div class="line">源码</div></pre></td></tr></table></figure></p>
</blockquote>
</blockquote>
</blockquote>
<h1 id="1-标题"><a href="#1-标题" class="headerlink" title="1.标题"></a>1.标题</h1><h2 id="2-标题"><a href="#2-标题" class="headerlink" title="2.标题"></a>2.标题</h2><h3 id="3-标题"><a href="#3-标题" class="headerlink" title="3.标题"></a>3.标题</h3><h4 id="4-标题"><a href="#4-标题" class="headerlink" title="4.标题"></a>4.标题</h4><h5 id="5-标题"><a href="#5-标题" class="headerlink" title="5.标题"></a>5.标题</h5><p>```</p>
<p>效果  </p>
<h1 id="1-标题-1"><a href="#1-标题-1" class="headerlink" title="1.标题"></a>1.标题</h1><h2 id="2-标题-1"><a href="#2-标题-1" class="headerlink" title="2.标题"></a>2.标题</h2><h3 id="3-标题-1"><a href="#3-标题-1" class="headerlink" title="3.标题"></a>3.标题</h3><h4 id="4-标题-1"><a href="#4-标题-1" class="headerlink" title="4.标题"></a>4.标题</h4><h5 id="5-标题-1"><a href="#5-标题-1" class="headerlink" title="5.标题"></a>5.标题</h5>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2015/01/03/2015-1-3-jekyll-build-blog/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="王亚楠">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Atopom博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2015/01/03/2015-1-3-jekyll-build-blog/" itemprop="url">通过GitHub和Jekyll搭建属于自己的博客</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-01-03T20:29:37+08:00">
                2015-01-03
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Jekyll/" itemprop="url" rel="index">
                    <span itemprop="name">Jekyll</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>很早之前就想弄一个自己的博客玩一玩，不过由于各种原因，主要还是本人比较懒，一直拖到现在才开始整。以前写一些笔记和心得都是通过CSDN或Evernote，都是方便留着自己查看的，写的也不是特别细心。现在为了提升自己，强逼自己做出一些改变，用心总结并分享出去。言归正传，今天给大家分享的是如何搭建自己的博客！</p>
</blockquote>
<ul>
<li>content<br>{:toc}</li>
</ul>
<h1 id="搭建博客的条件"><a href="#搭建博客的条件" class="headerlink" title="搭建博客的条件"></a>搭建博客的条件</h1><ol>
<li>注册GitHub的账号</li>
<li>安装Git环境、Jekyll环境</li>
<li>学会Markdown基础语法</li>
</ol>
<h2 id="Jekyll安装"><a href="#Jekyll安装" class="headerlink" title="Jekyll安装"></a>Jekyll安装</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ gem install jekyll</div></pre></td></tr></table></figure>
<p>注意：Jekyll环境在Mac上安装稍微遇到点问题（主要原因是Mac版本升级后对在其上面安装的程序的目录和权限有些变化，导致的一些乱七八糟的问题，随后百度、谷歌，也都解决了)。  </p>
<h2 id="手动搭建博客"><a href="#手动搭建博客" class="headerlink" title="手动搭建博客"></a>手动搭建博客</h2><h3 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h3><p>根据以下目录结构在你的username.github.io文件夹下建立以下目录结构：  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">* _config.yml  </div><div class="line">- _drafts  </div><div class="line">    * begin-with-the-crazy-ideas.textile  </div><div class="line">    * on-simplicity-in-technology.markdown  </div><div class="line">- _includes  </div><div class="line">    * footer.html  </div><div class="line">    * header.html  </div><div class="line">- _layouts  </div><div class="line">    * default.html  </div><div class="line">    * post.html  </div><div class="line">- _posts  </div><div class="line">    * 2015-1-3-jekyll-build-blog.md  </div><div class="line">    * 2015-1-3-Markdown-Grammar.md  </div><div class="line">- _site  </div><div class="line">    * index.html</div></pre></td></tr></table></figure>
<p>可以一个个依次建立起来，然后再自己编写一个你想要的博客。  </p>
<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><p>项目需要配置的只有一个文件<code>_config.yml</code>，打开之后按照如下进行配置。  </p>
<blockquote>
<p>特别注意<code>baseurl</code>的配置。如果是<code>***.github.io</code>项目，不修改为空’’的话，会导致JS,CSS等静态资源无法找到的错误</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">name: 博客名称</div><div class="line">email: 邮箱地址</div><div class="line">author: 作者名</div><div class="line">url: 个人网站</div><div class="line"><span class="comment">### baseurl修改为项目名，如果项目是'***.github.io'，则设置为空''</span></div><div class="line">baseurl: <span class="string">""</span></div><div class="line">resume_site: 个人简历网站</div><div class="line">github: github地址</div><div class="line">github_username: github用户名称</div><div class="line">FB:</div><div class="line">  comments:</div><div class="line">    provider: duoshuo</div><div class="line">    duoshuo:</div><div class="line">        short_name: 多说账户</div><div class="line">    disqus:</div><div class="line">        short_name: Disqus账户</div></pre></td></tr></table></figure>
<h3 id="写文章"><a href="#写文章" class="headerlink" title="写文章"></a>写文章</h3><p>在<code>./_posts</code>目录下新建一个文件，可以创建文件夹并在文件夹中添加文件，方便维护。在新建文件中粘贴如下信息，并修改以下的<code>titile</code>,<code>date</code>,<code>categories</code>,<code>tag</code>的相关信息，添加<code>* content {:toc}</code>为目录相关信息，在进行正文书写前需要在目录和正文之间输入至少2行空行。然后按照正常的Markdown语法书写正文。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">---</div><div class="line">layout: post</div><div class="line">title:  标题</div><div class="line">date:   2016-08-27 01:08:00 +0800</div><div class="line">categories: Work</div><div class="line">tag: Markdown</div><div class="line">---</div><div class="line"></div><div class="line">* content</div><div class="line">&#123;:toc&#125;</div><div class="line"></div><div class="line"></div><div class="line">正文......</div><div class="line">正文......</div><div class="line">正文......</div></pre></td></tr></table></figure>
<h3 id="查看效果"><a href="#查看效果" class="headerlink" title="查看效果"></a>查看效果</h3><p>在终端执行如下命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ jekyll server</div></pre></td></tr></table></figure>
<p>打开浏览器并输入URL<code>http://127.0.0.1:4000/</code>,回车。</p>
<h2 id="快速搭建博客"><a href="#快速搭建博客" class="headerlink" title="快速搭建博客"></a>快速搭建博客</h2><p>参考<a href="https://github.com/barryclark/jekyll-now/" target="_blank" rel="external">Jekyll-Now</a>，可以快速搭建极简样式博客。<br>参考<a href="http://jekyllthemes.org/" target="_blank" rel="external">Jekyll主题</a>，里面提供Jekyll的各种博客模版下载。  </p>
<h1 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h1><ol>
<li><a href="https://github.com/" target="_blank" rel="external">GitHub官网</a></li>
<li><a href="http://jekyllcn.com/" target="_blank" rel="external">Jekyll-CN</a></li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2014/05/01/android/2014-5-1-Android-Component-Activity/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="王亚楠">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Atopom博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2014/05/01/android/2014-5-1-Android-Component-Activity/" itemprop="url">Android-Component-Activity</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2014-05-01T14:56:06+08:00">
                2014-05-01
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Activity介绍"><a href="#Activity介绍" class="headerlink" title="Activity介绍"></a>Activity介绍</h1><p>Android应用组件Activity是Android程序的呈现层，显示可视化的用户界面，并接收与用户交互所产生的界面事件。对于一个Android应用程序来说，可以包含一个或多个Activity，一般在程序启动后会呈现一个Activity，用于提示用户程序已经正常启动。当它不积极运行时，Activity可以被操作系统终止以节省内存。</p>
<h1 id="Activity四种状态"><a href="#Activity四种状态" class="headerlink" title="Activity四种状态"></a>Activity四种状态</h1><ol>
<li>活动状态，Activity在用户界面中处于最上层，完全能被用户看到，且能和用户进行交互。（前台进程）</li>
<li>暂停状态，Activity在界面上被部分遮挡，该Activity不再处于用户界面的最上层，且不能够与用户进行交互。（可见但非前台进程）</li>
<li>停止状态，Activity在界面上完全不能被用户看到，也就是说该Activity被其他Activity全部遮挡。（后台进程）</li>
<li>非活动状态，不在以上3种状态的Activity则处于非活动状态。</li>
</ol>
<h1 id="Activity生命周期"><a href="#Activity生命周期" class="headerlink" title="Activity生命周期"></a>Activity生命周期</h1><ol>
<li>onCreate：     Activity被创建的时候调用（一般做初始化操作）</li>
<li>onStart：     Activity变成用户可见的时候调用</li>
<li>onResume：     界面获取焦点的时候调用</li>
<li>onPause：     界面失去焦点的时候调用</li>
<li>onStop：     Activity变成用户不可见的时候调用</li>
<li>onDestroy：     Activity被系统消毁的时候调用</li>
</ol>
<p><img src="/images/Android/Activity_Lifecycle.png" alt="Activity生命周期"></p>
<blockquote>
<p>如：同一个APP中一个Activity（A）跳转到另一个Activity（B）时：<br>A   onPause （A先进入onPause状态，B才能创建）<br>B   onCreate、onStart、onResume<br>A   onStop<br>所以，为了防止界面间切换的卡顿，不要在onPause和onResume方法中些许耗时的操作。<br>注意：当界面A调用界面B时，如果界面B是以对话框形式来打开的话（也就是界面A还能看得见），界面A只会执行onPause方法，同时返回到界面A时，也只会执行onResume。</p>
</blockquote>
<h2 id="内存不足被销毁的生命周期"><a href="#内存不足被销毁的生命周期" class="headerlink" title="内存不足被销毁的生命周期"></a>内存不足被销毁的生命周期</h2><ol>
<li>onSaveInstanceState：Android系统因资源不足终止Activity前，调用此方法。用于保存Activity的状态信息，供onRestoreInstanceState()或onCreate()恢复时用。</li>
<li>onRestoreInstanceState()：恢复onSaveInstanceState()保存的Activity状态信息，在onStart()之后调用。</li>
</ol>
<p><img src="/images/Android/Activity_Exception_Lifecycle.png" alt="Activity异常状态的工作过程"></p>
<h2 id="configChanges配置"><a href="#configChanges配置" class="headerlink" title="configChanges配置"></a>configChanges配置</h2><p>Activity在横竖屏切换的时候，会重走生命周期方法。<br>横竖屏切换activity不被消毁的设置：</p>
<blockquote>
<p>android:configChanges=”orientation|keyboardHidden|screenSize” // 4.0以下只需前两个参数</p>
</blockquote>
<p>注意：如果你的app一直是竖着显示的话，必须在所有Activity中设置：</p>
<blockquote>
<p>android:screenOrientation=”portrait”</p>
</blockquote>
<h2 id="横竖屏切换时候activity的生命周期"><a href="#横竖屏切换时候activity的生命周期" class="headerlink" title="横竖屏切换时候activity的生命周期"></a>横竖屏切换时候activity的生命周期</h2><ol>
<li>不设置Activity的android:configChanges时，屏幕方向发生改变，会重新调用各个生命周期。</li>
<li>设置Activity的android:configChanges=“orientation|screenSize”时，屏幕方向发生改变，生命周期不会重新调用，只会执行onConfigurationChanged方法。（screenSize，API13新添加）</li>
</ol>
<blockquote>
<p>获取任务栈【代码】<br>ActivityService.getRunningTasks()</p>
<p>killProcess【代码】<br>android.os.Process.killProcess(android.os.Process.myPid()); // Process类在lang中也存在，所以加上包名调用<br>System.exit(0);</p>
</blockquote>
<h1 id="清单文件默认配置"><a href="#清单文件默认配置" class="headerlink" title="清单文件默认配置"></a>清单文件默认配置</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&lt;intent-filter&gt;</div><div class="line">     &lt;action android:name=&quot;android.intent.action.MAIN&quot; /&gt; // 启动程序优先启动</div><div class="line">     &lt;category android:name=&quot;android.intent.category.LAUNCHER&quot; /&gt; // 桌面图标</div><div class="line">&lt;/intent-filter&gt;</div></pre></td></tr></table></figure>
<p>两个配置同时存在才会在桌面创建图标且点击图标优先启动该Activity</p>
<h1 id="Activity启动模式"><a href="#Activity启动模式" class="headerlink" title="Activity启动模式"></a>Activity启动模式</h1><ol>
<li><p>standard：标准模式</p>
</li>
<li><p>singleTop：栈顶复用模式</p>
<blockquote>
<p>开启Activity时，会检查当前与之和匹配的Task的栈顶是否存在该Activity，如果存在，则复用，并切会回掉Activity.onNewIntent方法。</p>
</blockquote>
</li>
<li><p>singleTask：栈内复用模式</p>
<blockquote>
<p>开启Activity时，会检查当前与之匹配的Task的任务栈中是否已有该Activity，如果有，则将任务栈中的该Activity上面的所有Activity全部Remove，然后显示出该Activity，并且回掉onNewIntent方法。这种启动模式主要是为了让某些比较消耗资源且只需一个的Activity在任务栈中只存在一个，防止创建太多而造成内存不足等。</p>
</blockquote>
</li>
<li><p>singleInstance：单实例模式</p>
<blockquote>
<p>让同一个Activity在任务栈中只存在一个（换句话说就是整个手机内存中该Activity只会存在一个，如我的程序开了该Activity，别的程序再开启，也是同一个）底层实现是新建一个任务栈专门存放该Activity，在用户调用该Activity时，该任务栈就会被放到原任务栈的前面。</p>
</blockquote>
</li>
</ol>
<h2 id="taskAffinity配置"><a href="#taskAffinity配置" class="headerlink" title="taskAffinity配置"></a>taskAffinity配置</h2><blockquote>
<p>TaskAffinity任务相关性。<br>主要和SingleTask启动模式或AllowTaskReparenting配置配对使用。</p>
</blockquote>
<h2 id="allowTaskReparenting配置"><a href="#allowTaskReparenting配置" class="headerlink" title="allowTaskReparenting配置"></a>allowTaskReparenting配置</h2><blockquote>
<p>是否允许Activity从一个Task迁移到另一个Task。</p>
</blockquote>
<h2 id="Activity的Flags"><a href="#Activity的Flags" class="headerlink" title="Activity的Flags"></a>Activity的Flags</h2><ol>
<li>FLAT_ACTIVITY_SINGLE_TOP，和XML中singleTop启动模式相同。</li>
<li>FLAG_ACTIVITY_NEW_TASK，和XML中singleTask启动模式相同。</li>
<li>FLAT_ACTIVITY_CLEAR_TOP，<br>在同一个任务栈中，所有位于它上面的Activity都会出栈。如果Activity使用standard启动模式，那么它连同它之上的Activity都要出栈，系统会创建新的Activity实例放入栈顶。</li>
<li>FLAT_ACTIVITY_EXCLUDE_FROM_RECENTS，<br>具有这个标记的Activity不会出现在历史Activity的列表中，当某些情况下我们不希望用户通过历史列表回到我们到Activity的时候，这个标记比较有用。它等同于XML中指定Activity的属性android:excludeFromRecents=“true”。</li>
</ol>
<h1 id="Activity常用方法"><a href="#Activity常用方法" class="headerlink" title="Activity常用方法"></a>Activity常用方法</h1><blockquote>
<p>用于别的线程更新UI的操作：runOnUiThread(Runnable action)，将更新ui的操作写到这个Runnable的run()中。该方法将会判断当前线程是否是创建UI的线程。如果是，则会直接运行。如果不是，将会跳到UI线程中执行。</p>
</blockquote>
<h1 id="Activity切换动画"><a href="#Activity切换动画" class="headerlink" title="Activity切换动画"></a>Activity切换动画</h1><blockquote>
<p>overridePendingTransition(R.anim.tran_in, R.anim.tran_out);<br>其中overridePendingTransition是Activity的方法，传递两个动画的xml配置文件。如：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">tran_in.xml</div><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</div><div class="line">&lt;translate xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</div><div class="line">    android:duration=&quot;500&quot;</div><div class="line">    android:fromXDelta=&quot;100%p&quot;</div><div class="line">    android:fromYDelta=&quot;0&quot;</div><div class="line">    android:toXDelta=&quot;0&quot;</div><div class="line">    android:toYDelta=&quot;0&quot; &gt;</div><div class="line">&lt;/translate&gt;</div><div class="line">tran_out.xml</div><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</div><div class="line">&lt;translate xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</div><div class="line">    android:duration=&quot;500&quot;</div><div class="line">    android:fromXDelta=&quot;0&quot;</div><div class="line">    android:fromYDelta=&quot;0&quot;</div><div class="line">    android:toXDelta=&quot;-100%p&quot;</div><div class="line">    android:toYDelta=&quot;0&quot; &gt;</div><div class="line">&lt;/translate&gt;</div></pre></td></tr></table></figure></p>
</blockquote>
<h1 id="伪桌面（透明背景、无标题）"><a href="#伪桌面（透明背景、无标题）" class="headerlink" title="伪桌面（透明背景、无标题）"></a>伪桌面（透明背景、无标题）</h1><blockquote>
<p>在清单文件中加入 android:theme=”@android:style/Theme.Translucent.NoTitleBar”</p>
</blockquote>
<h1 id="有关setContentView-方法的底层原理"><a href="#有关setContentView-方法的底层原理" class="headerlink" title="有关setContentView()方法的底层原理"></a>有关setContentView()方法的底层原理</h1><blockquote>
<p>首先每个控件都是不能自己设定宽高的，需要外面有一个ViewGroup包起来，设定宽高才有效。<br>而如果是这样的话，那样每个xml的最外层的ViewGroup的宽高都是无效的吗？其实不是，其实每个Activity默认就存在着一个FrameLayout。</p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2014/04/05/java/2014-4-5-Java-CountDownLatch/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="王亚楠">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Atopom博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2014/04/05/java/2014-4-5-Java-CountDownLatch/" itemprop="url">Java-CountDownLatch</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2014-04-05T13:08:16+08:00">
                2014-04-05
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index">
                    <span itemprop="name">Java</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="CountDownLatch是什么？"><a href="#CountDownLatch是什么？" class="headerlink" title="CountDownLatch是什么？"></a>CountDownLatch是什么？</h1><blockquote>
<p>CountDownLatch 位于java.util.concurrent包下，是JDK5.0的新特性，根据包名便可知，它是用于处理多线程并发的工具类。</p>
</blockquote>
<h1 id="CountDownLatch能干什么？"><a href="#CountDownLatch能干什么？" class="headerlink" title="CountDownLatch能干什么？"></a>CountDownLatch能干什么？</h1><blockquote>
<p>CountDownLatch 能够使一个线程处于等待状态，直到它期望的其他线程达到预期，再恢复运行状态。</p>
</blockquote>
<h1 id="CountDownLatch的运行原理"><a href="#CountDownLatch的运行原理" class="headerlink" title="CountDownLatch的运行原理"></a>CountDownLatch的运行原理</h1><blockquote>
<p>CountDownLatch 是通过一个计数器来实现的，计数器的初始值为线程数。<br>每当一个线程完成任务后，计数器的值就会减1。当计数器的值为0时，它表示所线程已经完成任务，然后在闭锁上等待线程就恢复运行状态。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">1. Main thread start</div><div class="line">2. Create CountDownLatch for N threads</div><div class="line">3. Create and start N threads</div><div class="line">4. Main thread wait on latch</div><div class="line">5. N threads completes there tasks are returns</div><div class="line">6. Main thread resume execution</div></pre></td></tr></table></figure>
<p><img src="/images/Java/CountDownLatch_Work_Mechanism.png" alt="CountDownLatch原理"></p>
<h1 id="CountDownLatch主要API"><a href="#CountDownLatch主要API" class="headerlink" title="CountDownLatch主要API"></a>CountDownLatch主要API</h1><ol>
<li><p>构造函数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">//Constructs a CountDownLatch initialized with the given count.</div><div class="line">public void CountDownLatch(int count) &#123;…&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>让线程处于等待状态的函数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">CountDownLatch.await()</div></pre></td></tr></table></figure>
</li>
<li><p>让线程恢复执行状态的函数（cnt=0时，线程恢复运行状态）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">CountDownLatch.countDown()</div></pre></td></tr></table></figure>
</li>
</ol>
<h1 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h1><blockquote>
<p>主线程启动三个子线程，完成各自的验证工作后，主线程再继续运行，使用CountDownLatch进行实现。</p>
</blockquote>
<h2 id="主程序入口"><a href="#主程序入口" class="headerlink" title="主程序入口"></a>主程序入口</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">package com.atopom.jdk5.concurrent.countdownlatch;</div><div class="line"></div><div class="line">public class _Main &#123;</div><div class="line">	public static void main(String[] args) &#123;</div><div class="line">		boolean result = false;</div><div class="line">		try &#123;</div><div class="line">			result = ApplicationStartupUtil.checkExternalServices();</div><div class="line">		&#125; catch (Exception e) &#123;</div><div class="line">			e.printStackTrace();</div><div class="line">		&#125;</div><div class="line">		System.out.println(&quot;External services validation completed !! Result was :: &quot; + result);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="运行结果"><a href="#运行结果" class="headerlink" title="运行结果"></a>运行结果</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">Checking Cache Service</div><div class="line">Checking Database Service</div><div class="line">Checking Network Service</div><div class="line">Database Service is UP</div><div class="line">Cache Service is UP</div><div class="line">Network Service is UP</div><div class="line">External services validation completed !! Result was :: true</div></pre></td></tr></table></figure>
<h1 id="代码地址"><a href="#代码地址" class="headerlink" title="代码地址"></a>代码地址</h1><blockquote>
<p><a href="https://github.com/atopom/java_familiar_strange/tree/master/Code/CountDownLatchDemo" target="_blank" rel="external">https://github.com/atopom/java_familiar_strange/tree/master/Code/CountDownLatchDemo</a></p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  


          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/uploads/avatar.png"
               alt="王亚楠" />
          <p class="site-author-name" itemprop="name">王亚楠</p>
           
              <p class="site-description motion-element" itemprop="description">工作、分享、笔记</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">10</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">8</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">16</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/atopom" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                    
                      GitHub
                    
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">王亚楠</span>
</div>

        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.2"></script>



  
    <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  





  






  





  

  

  

  

  

  

</body>
</html>
